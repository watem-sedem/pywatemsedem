<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pywatemsedem.io.modeloutput &mdash; pywatemsedem 0.0.1a2.post1.dev2+g19434b0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=fbdb9ebb" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/documentation_options.js?v=2be448b1"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pywatemsedem
          </a>
              <div class="version">
                0.0.1a2.post1.dev2+g19434b0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">pywatemsedem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Module Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/api.html">Data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/calibrate.html">Calibrating WaTEM/SEDEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/geo.html">Processing rasters and vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/userchoices.html">User Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/io.html">IO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Development guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html#package-release">Package release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../codeofconduct.html">Code of conduct</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pywatemsedem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pywatemsedem.io.modeloutput</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pywatemsedem.io.modeloutput</h1><div class="highlight"><pre>
<span></span><span class="c1"># seperate plotting funcion</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># hvplot functionalities</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">LineString</span>

<span class="kn">from</span> <span class="nn">pywatemsedem.plots</span> <span class="kn">import</span> <span class="n">plot_cumulative_sedimentload</span>

<span class="kn">from</span> <span class="nn">..geo.factory</span> <span class="kn">import</span> <span class="n">Factory</span>
<span class="kn">from</span> <span class="nn">..geo.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_raster_properties_raster_with_template</span><span class="p">,</span>
    <span class="n">clean_up_tempfiles</span><span class="p">,</span>
    <span class="n">create_spatial_index</span><span class="p">,</span>
    <span class="n">execute_saga</span><span class="p">,</span>
    <span class="n">load_raster</span><span class="p">,</span>
    <span class="n">mask_array_with_val</span><span class="p">,</span>
    <span class="n">raster_array_to_pandas_dataframe</span><span class="p">,</span>
    <span class="n">raster_dataframe_to_arr</span><span class="p">,</span>
    <span class="n">raster_to_polygon</span><span class="p">,</span>
    <span class="n">rst_to_vct_points</span><span class="p">,</span>
    <span class="n">write_arr_as_rst</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..io.plots</span> <span class="kn">import</span> <span class="n">axes_creator</span>  <span class="c1"># hvplot_continuous_raster,</span>
<span class="kn">from</span> <span class="nn">..io.plots</span> <span class="kn">import</span> <span class="n">log_scale_enabler</span><span class="p">,</span> <span class="n">plot_continuous_raster</span><span class="p">,</span> <span class="n">plot_output_raster</span>
<span class="kn">from</span> <span class="nn">..io.valid</span> <span class="kn">import</span> <span class="n">valid_array_type</span><span class="p">,</span> <span class="n">valid_boundaries</span><span class="p">,</span> <span class="n">valid_non_nan</span>

<span class="n">IMPLEMENTED_RASTER_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
<span class="n">COLORMAP</span> <span class="o">=</span> <span class="s2">&quot;cividis&quot;</span>
<span class="n">COLORMAP_SEDIOUT</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
    <span class="s2">&quot;SediOutcmap&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span> <span class="s2">&quot;#fecc5c&quot;</span><span class="p">,</span> <span class="s2">&quot;#ff8c00&quot;</span><span class="p">,</span> <span class="s2">&quot;#d7191c&quot;</span><span class="p">,</span> <span class="s2">&quot;#bd0026&quot;</span><span class="p">]</span>
<span class="p">)</span>


<div class="viewcode-block" id="Modeloutput">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.Modeloutput">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Modeloutput</span><span class="p">(</span><span class="n">Factory</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">nodata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AbstractRaster class with model outputs as attributes. Modeloutput class</span>
<span class="sd">        serves the goal of automating the reading in, checking and visualisation</span>
<span class="sd">        of the output data of the CNWS model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        template: pathlib.Path | str</span>
<span class="sd">            Template raster needed to extract raster properties.</span>
<span class="sd">            Raster contains values in [0,1]. Values in ]0,1] define the catchment.</span>
<span class="sd">        resolution: int</span>
<span class="sd">            See :class:`pywatemsedem.geo.RasterProperties`.</span>
<span class="sd">        epsg: int</span>
<span class="sd">            See :class:`pywatemsedem.geo.RasterProperties`.</span>
<span class="sd">        nodata: float</span>
<span class="sd">            See :class:`pywatemsedem.geo.RasterProperties`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">nodata</span><span class="p">,</span> <span class="n">template</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">template</span>

        <span class="c1"># DATA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sediout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_missing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ls</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slope</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uparea</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_sediment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sewer_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_export</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rusle</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sediout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter SediOut attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:sedioutrst&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sediout</span>

    <span class="nd">@sediout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sediout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sediout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># checks on raster data</span>
        <span class="n">valid_non_nan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sediout</span><span class="o">.</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sediout</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sediout</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sediout</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;SediOut [kg/year]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
            <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for SediOut with nonlinear colorscale. Masked under 100 kg/year.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = [0,10000,20000,40000,80000]</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    If ticks = None, 0th, 25th, 50th, 75th and 100th percentile of</span>
<span class="sd">                    the data are used as ticks</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sediout</span><span class="o">.</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sediout</span><span class="o">.</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">ticks</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">COLORMAP_SEDIOUT</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sediout</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter routing attribute.</span>
<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:routingtxt&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span>

    <span class="nd">@routing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">routing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txt_routing</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># checks</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;row&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nrows</span><span class="p">)</span>

        <span class="n">arr_target1col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target1col&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target1col&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target1col</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">arr_target1row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target1row&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target1row&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target1row</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nrows</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;part1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;distance1&quot;</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">arr_target2col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target2col&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target2col&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target2col</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">arr_target2row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target2row&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target2row&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target2row</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nrows</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;part2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;distance2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Interactive plot for routing</span>

<span class="sd">            Returns</span>
<span class="sd">            --------</span>
<span class="sd">            folium.folium.Map</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Apply .make_routing_vector(...) on&quot;</span>
                <span class="n">msg1</span> <span class="o">=</span> <span class="s2">&quot; Modeloutput before calling .plot()&quot;</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
            <span class="c1"># Future implementation: try to draw arrow in correct direction</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routing_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter routing_missing attribute.</span>
<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:missingroutingtxt&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_missing</span>

    <span class="nd">@routing_missing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">routing_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        text: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txt_routing_missing</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing_missing</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;routing_missing is empty&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># checks like routing</span>
            <span class="n">valid_boundaries</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">ncols</span>
            <span class="p">)</span>
            <span class="n">valid_boundaries</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="p">[</span><span class="s2">&quot;row&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nrows</span>
            <span class="p">)</span>

            <span class="n">arr_target1col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target1col&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target1col&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target1col</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
            <span class="n">arr_target1row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target1row&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target1row&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target1row</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nrows</span><span class="p">)</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="p">[</span><span class="s2">&quot;part1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="p">[</span><span class="s2">&quot;distance1&quot;</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">arr_target2col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target2col&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target2col&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target2col</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
            <span class="n">arr_target2row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing</span><span class="p">[</span><span class="s2">&quot;target2row&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;target2row&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">arr_target2row</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nrows</span><span class="p">)</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="p">[</span><span class="s2">&quot;part2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="p">[</span><span class="s2">&quot;distance2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Interactive plot for routing_missing</span>

<span class="sd">            Returns</span>
<span class="sd">            --------</span>
<span class="sd">            folium.folium.Map</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;routing_missing is empty, no plot is generated&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing_missing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;Apply .make_routing_vector(...,routing_missing = True) on&quot;</span>
                        <span class="s2">&quot; Modeloutput before calling .plot()&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing_missing</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_missing</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter LS (length-slope) attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:lsmap&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ls</span>

    <span class="nd">@ls</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;LS [-]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for LS with non-linear colormap</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">ticks</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ls</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter slope attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:slopemap&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slope</span>

    <span class="nd">@slope</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Slope [rad]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for Slope with non-linear colormap</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile of the data</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">ticks</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_slope</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uparea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter uparea attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:upareamap&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uparea</span>

    <span class="nd">@uparea</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">uparea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uparea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uparea</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uparea</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uparea</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;uparea [m²]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for uparea with non-linear colormap</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># masks out river based on ls</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Assign ls to Modeloutput before plotting uparea&quot;</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uparea</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">ticks</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_uparea</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_sediment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter total sediment attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:totalsedimenttxt&gt;`.</span>
<span class="sd">        For explanation on colmun variables of dataframe: see</span>
<span class="sd">        :func:`pywatemsedem.pywatemsedem.cnwsoutput.load_total_sediment_file`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_sediment</span>

    <span class="nd">@total_sediment</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">total_sediment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="n">load_total_sediment_file</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_sediment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sewer_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter sewer_in attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:sewerinrst&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sewer_in</span>

    <span class="nd">@sewer_in</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sewer_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sewer_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;sewer in [kg/year]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for sewer_in with non-linear colormap. Zeros are filtered out</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile of</span>
<span class="sd">                    the data excluding zero values</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">ticks</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">COLORMAP_SEDIOUT</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sewer_in</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sedi_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter SediExport attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:sediexportrst&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_export</span>

    <span class="nd">@sedi_export</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sedi_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_export</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sewer_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sedi_export</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sedi_export</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;SediExport [kg/year]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for SediExport with non-linear colormap. Zeros are filtered out</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile of the data</span>
<span class="sd">                    available in the rivercells excluding zeros</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes_creator</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sedi_export</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sedi_export</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sedi_export</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="c1"># mask where the river is not present</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Assign ls to Modeloutput before plotting SediExport&quot;</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ticks</span><span class="p">:</span>
                <span class="n">arr_nozeros</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">arr_nozeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">arr_nozeros</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">arr_nozeros</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
                <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                    <span class="n">ticks</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># avoids problems with invalid vmin or vmax</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">ticks</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">COLORMAP_SEDIOUT</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_export</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sedi_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter SediIn attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:sediinrst&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_in</span>

    <span class="nd">@sedi_in</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sedi_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sedi_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sedi_in</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sedi_in</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;SediIn [kg/year]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
            <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for SediIn</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = [0,10000,20000,40000,80000]</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    If ticks =None, 0th, 25th, 50th, 75th and 100th percentile</span>
<span class="sd">                    of the data are used as ticks</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sedi_in</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">COLORMAP_SEDIOUT</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sedi_in</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter capacity attribute.</span>

<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:capacityrst&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span>

    <span class="nd">@capacity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Capacity [kg/year]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for Capacity with logarithmic colormap</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Assign ls to Modeloutput before plotting Capacity&quot;</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes_creator</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">log_scale_enabler</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">cnorm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_continuous_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rusle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter rusle attribute.</span>


<span class="sd">        For documentation, see :ref:`here &lt;watemsedem:ruslerst&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rusle</span>

    <span class="nd">@rusle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rusle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        raster: pathlib.Path | str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rusle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">valid_array_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">],</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;RUSLE [kg/(year.m²)]&quot;</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot for RUSLE</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fig: matplotlib.figure.Figure, default = None</span>
<span class="sd">                if not given, defaults to generating new figure</span>
<span class="sd">            ax: matplotlib.pyplot.axis, default = None</span>
<span class="sd">                if not given, defaults to generating new axis</span>
<span class="sd">            ticks: list, default = None</span>
<span class="sd">                    Possibility to supply a list of 5 values for ticks of colorscale.</span>
<span class="sd">                    Default is 0th, 25th, 50th, 75th and 100th percentile of the data</span>
<span class="sd">                    excluding zero values</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig: matplotlib.figure.Figure</span>

<span class="sd">            ax: matplotlib.axes.Axes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">mask_array_with_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rusle</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rusle</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_output_raster</span><span class="p">(</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">arr</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rusle</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

<div class="viewcode-block" id="Modeloutput.make_routing_vector">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.Modeloutput.make_routing_vector">[docs]</a>
    <span class="k">def</span> <span class="nf">make_routing_vector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">landuse</span><span class="p">,</span> <span class="n">sediout</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">routing_missing</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts pandas dataframe of routing or routing_missing to a geopandas</span>
<span class="sd">        dataframe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        landuse: pathlib.Path | str | str</span>
<span class="sd">                Path of landuse raster</span>
<span class="sd">        sediout: pathlib.Path | str | str</span>
<span class="sd">                Path of sediout raster</span>
<span class="sd">        percentile: int, default = 90</span>
<span class="sd">            Only vectors belonging to SediOutdata percentile and higher is kept</span>
<span class="sd">        routing_missing: bool, default = False</span>
<span class="sd">                        set to True to apply function to routing_missing instead</span>
<span class="sd">                        of routing</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        geopandas.GeoDataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raster</span><span class="p">,</span> <span class="n">landuse_rasterio_profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">landuse</span><span class="p">)</span>
        <span class="c1"># cheks op raster</span>
        <span class="n">valid_non_nan</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
        <span class="n">valid_array_type</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">required_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
        <span class="n">valid_boundaries</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mi">32757</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">32757</span><span class="p">)</span>
        <span class="n">check_raster_properties_raster_with_template</span><span class="p">(</span>
            <span class="n">landuse</span><span class="p">,</span> <span class="n">landuse</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span>
        <span class="p">)</span>

        <span class="c1"># selecting what to vectorise</span>
        <span class="n">sediout_arr</span><span class="p">,</span> <span class="n">sediout_profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">sediout</span><span class="p">)</span>
        <span class="n">sediout_df</span> <span class="o">=</span> <span class="n">raster_array_to_pandas_dataframe</span><span class="p">(</span><span class="n">sediout_arr</span><span class="p">,</span> <span class="n">sediout_profile</span><span class="p">)</span>
        <span class="n">seditout_df_sel</span> <span class="o">=</span> <span class="n">sediout_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">sediout_df</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sediout_df</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">],</span> <span class="n">percentile</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">routing_missing</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_missing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;target1col&quot;</span><span class="p">:</span> <span class="s2">&quot;targetcol1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;target1row&quot;</span><span class="p">:</span> <span class="s2">&quot;targetrow1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;target2col&quot;</span><span class="p">:</span> <span class="s2">&quot;targetcol2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;target2row&quot;</span><span class="p">:</span> <span class="s2">&quot;targetrow2&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">wide_to_long</span><span class="p">(</span>
            <span class="n">df_temp</span><span class="p">,</span>
            <span class="n">i</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="s2">&quot;row&quot;</span><span class="p">],</span>
            <span class="n">stubnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;targetcol&quot;</span><span class="p">,</span> <span class="s2">&quot;targetrow&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;part&quot;</span><span class="p">],</span>
            <span class="n">j</span><span class="o">=</span><span class="s2">&quot;cell&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_comb</span> <span class="o">=</span> <span class="n">seditout_df_sel</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_temp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="s2">&quot;col&quot;</span><span class="p">])</span>
        <span class="c1"># filter out data where part = 0 of None/NaN</span>
        <span class="n">df_comb</span> <span class="o">=</span> <span class="n">df_comb</span><span class="p">[</span><span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;part&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">df_comb</span> <span class="o">=</span> <span class="n">df_comb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;part&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span>

        <span class="c1"># + and - self.rp.resolution/2 for correction of vectors</span>
        <span class="c1"># being in center of cell</span>
        <span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;sourceX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>  <span class="c1"># bounds[0] = xmin</span>
        <span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;sourceY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="o">-</span><span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;row&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>  <span class="c1"># bounds[3] = ymax</span>
        <span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;targetX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;targetcol&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;targetY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="o">-</span><span class="n">df_comb</span><span class="p">[</span><span class="s2">&quot;targetrow&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">LineString</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="n">df_comb</span><span class="o">.</span><span class="n">sourceX</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">df_comb</span><span class="o">.</span><span class="n">sourceY</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">df_comb</span><span class="o">.</span><span class="n">targetX</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">df_comb</span><span class="o">.</span><span class="n">targetY</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_comb</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">routing_missing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing_missing</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                <span class="n">df_comb</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing_missing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                <span class="n">df_comb</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdf_routing</span></div>
</div>



<div class="viewcode-block" id="get_prckrt_statistics">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.get_prckrt_statistics">[docs]</a>
<span class="k">def</span> <span class="nf">get_prckrt_statistics</span><span class="p">(</span><span class="n">rst_prckrt</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ha&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the statistics of the WaTEM/SEDEM perceelskaart</span>

<span class="sd">    Load the WaTEM/SEDEM perceelskaart and compute for every unique id the area</span>
<span class="sd">    (ha or m2).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_prckrt: str or pathlib.Path | str</span>
<span class="sd">        File path ofWaTEM/SEDEM perceelskaart</span>
<span class="sd">    unit: str</span>
<span class="sd">        The unit of the output, currently pixel, m2 and ha implemented</span>
<span class="sd">    resolution: int</span>
<span class="sd">        Resolution of the rasters</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out: dict,</span>
<span class="sd">        Area for each class, keys:</span>

<span class="sd">            - *agriculture* (float): area (ha/m2)</span>
<span class="sd">            - *river* (float): area (ha/m2)</span>
<span class="sd">            - *infrastructure* (float): area (ha/m2)</span>
<span class="sd">            - *forest* (float): area (ha/m2)</span>
<span class="sd">            - *meadow* (float): area (ha/m2)</span>
<span class="sd">            - *open_water* (float): area (ha/m2)</span>
<span class="sd">            - *gras_strip* (float): area (ha/m2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr_prckrt</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_prckrt</span><span class="p">,</span> <span class="n">list_format</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">arr_prckrt</span> <span class="o">=</span> <span class="n">arr_prckrt</span><span class="p">[</span><span class="n">arr_prckrt</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]]</span>
    <span class="n">arr_prckrt</span><span class="p">[</span><span class="n">arr_prckrt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr_prckrt</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ha&quot;</span><span class="p">,</span> <span class="s2">&quot;pixel&quot;</span><span class="p">,</span> <span class="s2">&quot;m2&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;ha&quot;</span><span class="p">:</span>
            <span class="n">convert_unit</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">100</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;pixel&quot;</span><span class="p">:</span>
            <span class="n">convert_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;m2&quot;</span><span class="p">:</span>
            <span class="n">convert_unit</span> <span class="o">=</span> <span class="n">resolution</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unit &#39;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&#39; not defined, cannot convert unit from pixel to &quot;</span>
            <span class="s2">&quot;unit. Please select pixel, ha or m2&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;agriculture&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;river&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;infrastructure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="o">-</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;forest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="o">-</span><span class="mi">3</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;meadow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="o">-</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="o">-</span><span class="mi">4</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;open_water&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="o">-</span><span class="mi">5</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;gras_strip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">unique</span> <span class="o">==</span> <span class="o">-</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="o">-</span><span class="mi">6</span> <span class="ow">in</span> <span class="n">unique</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">convert_unit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">convert_unit</span>

    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="make_routing_vct_saga">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.make_routing_vct_saga">[docs]</a>
<span class="k">def</span> <span class="nf">make_routing_vct_saga</span><span class="p">(</span>
    <span class="n">txt_routing</span><span class="p">,</span> <span class="n">rst_prckrt</span><span class="p">,</span> <span class="n">vct_out</span><span class="p">,</span> <span class="n">rstparams</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tile_number</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a routing vct routing file (added with CNWS landuse) based on</span>
<span class="sd">    the routing table</span>
<span class="sd">    extent and tilenumber are defined to make a routing file only for a</span>
<span class="sd">    certain extent</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    txt_routing: str or pathlib.Path | str</span>
<span class="sd">        File path of the WaTEM/SEDEM routing tabl</span>
<span class="sd">    rst_prckrt: str</span>
<span class="sd">        name of CNWS input &#39;perceelskaart&#39;</span>
<span class="sd">    vct_out:</span>
<span class="sd">        name of the shape outputfile</span>
<span class="sd">    rstparams: dict</span>
<span class="sd">        gdal dictionary holding all metadata for idrisi rasters</span>
<span class="sd">    extent: list, default None</span>
<span class="sd">        list holding value of extent to consider, xmin,ymin,xmax,ymax</span>
<span class="sd">    tile_number: int, optional, default None</span>
<span class="sd">        number of the tile, used to add to filename</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vct_out: str</span>
<span class="sd">        The resulting vector file will contain following features:</span>

<span class="sd">        - *col* (int): source column number.</span>
<span class="sd">        - *row* (int): source row number.</span>
<span class="sd">        - *targetcol* (int): target column number.</span>
<span class="sd">        - *targetcol* (int): source column number.</span>
<span class="sd">        - *part* (float): fraction of source that flows to target (between 0 and 1).</span>
<span class="sd">        - *distance* (float): distance of routing (m)</span>
<span class="sd">        - *landuSource* (int): landuse code of source pixel</span>
<span class="sd">        - *landuTarg* (int): landuse code of target pixel</span>
<span class="sd">        - *jump* (int): yes (1) or no (0)</span>
<span class="sd">        - *targetX* (float): x coor value of target</span>
<span class="sd">        - *targetY* (float): y coor value of target</span>
<span class="sd">        - *sourceX* (float): x coor value of source</span>
<span class="sd">        - *sourceY* (float): y coor value of source</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># condition tag for making routing shape</span>
    <span class="k">if</span> <span class="n">txt_routing</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="c1"># check if file is tab seperated</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">seperator</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span> <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">first_line</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="c1"># prepare the txt_file for conversion to routing shape</span>
        <span class="n">vct_temp</span><span class="p">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">prepare_make_routing_vct_saga</span><span class="p">(</span>
            <span class="n">txt_routing</span><span class="p">,</span> <span class="n">vct_out</span><span class="p">,</span> <span class="n">seperator</span><span class="p">,</span> <span class="n">rstparams</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">tile_number</span>
        <span class="p">)</span>

        <span class="c1"># if condition True, run, if False (no routing segments available in</span>
        <span class="c1"># routing table) don&#39;t run</span>
        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
            <span class="n">run_saga_make_routing_shp_cmd</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">,</span> <span class="n">rst_prckrt</span><span class="p">,</span> <span class="n">vct_out</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vct_out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No valid extent to clip routing &quot;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">txt_routing</span><span class="si">}</span><span class="s2">&#39; does not exist!&quot;</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>



<div class="viewcode-block" id="prepare_make_routing_vct_saga">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.prepare_make_routing_vct_saga">[docs]</a>
<span class="k">def</span> <span class="nf">prepare_make_routing_vct_saga</span><span class="p">(</span>
    <span class="n">txt_routing</span><span class="p">,</span> <span class="n">vct_out</span><span class="p">,</span> <span class="n">seperator</span><span class="p">,</span> <span class="n">rstparams</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">tile_number</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare the input files for make routing vct_saga</span>
<span class="sd">    If an extension is defined, then this function will clip the file to</span>
<span class="sd">    this rectangular geographical extent</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    txt_routing_nonriver: str or pathlib.Path | str</span>
<span class="sd">        File path of the WaTEM/SEDEM routing tabl</span>
<span class="sd">    vct_out: str</span>
<span class="sd">        name of output shapefile for &#39;run_saga_make_routing_shp_cmd&#39; fuction</span>
<span class="sd">    seperator: str</span>
<span class="sd">        current delimited of txt_routing</span>
<span class="sd">    rstparams: dict</span>
<span class="sd">        gdal dictionary holding all metadata for idrisi rasters</span>
<span class="sd">    extent: list</span>
<span class="sd">        min and max of rectangular frame to clip df [xmin, xmax, ymin, ymax]</span>
<span class="sd">    tile_number: int</span>
<span class="sd">        number of tile</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vct_temp: str</span>
<span class="sd">        The resulting vector file will contain following features:</span>

<span class="sd">        - *col* (int): source column number.</span>
<span class="sd">        - *row* (int): source row number.</span>
<span class="sd">        - *targetcol* (int): target column number.</span>
<span class="sd">        - *targetcol* (int): source column number.</span>
<span class="sd">        - *part* (float): fraction of source that flows to target (between 0 and 1).</span>
<span class="sd">        - *distance* (float): distance of routing (m)</span>
<span class="sd">        - *landuSource* (int): landuse code of source pixel</span>
<span class="sd">        - *landuTarg* (int): landuse code of target pixel</span>
<span class="sd">        - *jump* (int): yes (1) or no (0)</span>
<span class="sd">        - *targetX* (float): x coor value of target</span>
<span class="sd">        - *targetY* (float): y coor value of target</span>
<span class="sd">        - *sourceX* (float): x coor value of source</span>
<span class="sd">        - *sourceY* (float): y coor value of source</span>
<span class="sd">    condition: boolean</span>
<span class="sd">        True if make_routing_shp has to be run</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if an extent is defined for conversion to shape file, if not,</span>
    <span class="c1"># take whole domain txt_routing</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_routing</span> <span class="o">=</span> <span class="n">open_txt_routing_file</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_routing</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt_routing</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is empty&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">df_routing</span> <span class="o">=</span> <span class="n">condition_routing_dataframe_on_extent</span><span class="p">(</span>
            <span class="n">df_routing</span><span class="p">,</span> <span class="n">rstparams</span><span class="p">,</span> <span class="n">extent</span>
        <span class="p">)</span>
        <span class="c1"># rename files</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_selected_</span><span class="si">{</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">tile_number</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">tile_number</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">txt_routing</span> <span class="o">=</span> <span class="n">txt_routing</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">txt_routing</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
        <span class="n">vct_temp</span> <span class="o">=</span> <span class="n">vct_out</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">vct_out</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;.shp&quot;</span>
        <span class="k">if</span> <span class="n">seperator</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">df_routing</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># condition true if routing directions are found within extent</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_routing</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># condition = True if no extent given</span>
        <span class="n">vct_temp</span> <span class="o">=</span> <span class="n">vct_out</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df_routing</span> <span class="o">=</span> <span class="n">open_txt_routing_file</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_routing</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt_routing</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is empty&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seperator</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">df_routing</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vct_temp</span><span class="p">,</span> <span class="n">condition</span></div>



<div class="viewcode-block" id="condition_routing_dataframe_on_extent">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.condition_routing_dataframe_on_extent">[docs]</a>
<span class="k">def</span> <span class="nf">condition_routing_dataframe_on_extent</span><span class="p">(</span><span class="n">df_routing</span><span class="p">,</span> <span class="n">rstparams</span><span class="p">,</span> <span class="n">extent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clip routing_dataframe on defined extent</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df_routing: pandas.DataFrame</span>
<span class="sd">        See :func:`pywatemsedem.io.modeloutput.open_txt_routing_file`</span>
<span class="sd">    rstparams: dict</span>
<span class="sd">        gdal dictionary holding all metadata for idrisi rasters</span>
<span class="sd">    extent: list</span>
<span class="sd">        min and max of rectangular frame to clip df [xmin, xmax, ymin, ymax]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_routing: pandas.DataFrame</span>
<span class="sd">        See :func:`pywatemsedem.io.modeloutput.open_txt_routing_file`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get xmin and ymin from rasterproperties</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">rstparams</span><span class="p">[</span><span class="s2">&quot;minmax&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">rstparams</span><span class="p">[</span><span class="s2">&quot;minmax&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># compile x and y&#39;s of source points in df</span>
    <span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">rstparams</span><span class="p">[</span><span class="s2">&quot;res&quot;</span><span class="p">]</span>
    <span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="n">rstparams</span><span class="p">[</span><span class="s2">&quot;nrows&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;row&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">rstparams</span><span class="p">[</span><span class="s2">&quot;res&quot;</span><span class="p">]</span>
    <span class="c1"># condition</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">df_routing</span> <span class="o">=</span> <span class="n">df_routing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">df_routing</span></div>



<div class="viewcode-block" id="run_saga_make_routing_shp_cmd">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.run_saga_make_routing_shp_cmd">[docs]</a>
<span class="k">def</span> <span class="nf">run_saga_make_routing_shp_cmd</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">,</span> <span class="n">rst_prckrt</span><span class="p">,</span> <span class="n">vct_out</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the saga make routing shape command. This command makes from a pywatemsedem</span>
<span class="sd">    routing table and a pywatemsedem &#39;perceelskaart&#39; a routing shapfile</span>
<span class="sd">    representation.</span>

<span class="sd">    The resulting vector file will contain following features:</span>

<span class="sd">    - *col* (int): source column number.</span>
<span class="sd">    - *row* (int): source row number.</span>
<span class="sd">    - *targetcol* (int): target column number.</span>
<span class="sd">    - *targetcol* (int): source column number.</span>
<span class="sd">    - *part* (float): fraction of source that flows to target (between 0 and 1).</span>
<span class="sd">    - *distance* (float): distance of routing (m)</span>
<span class="sd">    - *landuSource* (int): landuse code of source pixel</span>
<span class="sd">    - *landuTarg* (int): landuse code of target pixel</span>
<span class="sd">    - *jump* (int): yes (1) or no (0)</span>
<span class="sd">    - *targetX* (float): x coor value of target</span>
<span class="sd">    - *targetY* (float): y coor value of target</span>
<span class="sd">    - *sourceX* (float): x coor value of source</span>
<span class="sd">    - *sourceY* (float): y coor value of source</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    txt_routing_nonriver: str or pathlib.Path | str</span>
<span class="sd">        File path of the WaTEM/SEDEM routing table</span>
<span class="sd">    rst_prckrt: str</span>
<span class="sd">        File path of the WaTEM/SEDEM &#39;perceelskaart&#39; raster</span>
<span class="sd">    vct_out: str</span>
<span class="sd">        File path of the output file</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;saga_cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;-f=s&quot;</span><span class="p">,</span> <span class="s2">&quot;topology&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]</span>
    <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-ROUTING&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">)]</span>
    <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="s2">&quot;-LANDUSE&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">rst_prckrt</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-OUTPUTLINES&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vct_out</span><span class="p">)]</span>
    <span class="n">execute_saga</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">)</span>
    <span class="n">create_spatial_index</span><span class="p">(</span><span class="n">vct_out</span><span class="p">)</span></div>



<div class="viewcode-block" id="define_subcatchments_saga">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.define_subcatchments_saga">[docs]</a>
<span class="k">def</span> <span class="nf">define_subcatchments_saga</span><span class="p">(</span>
    <span class="n">rst_in</span><span class="p">,</span>
    <span class="n">txt_routing</span><span class="p">,</span>
    <span class="n">resmap</span><span class="p">,</span>
    <span class="n">rasterprop</span><span class="p">,</span>
    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define subcatchment for several points defined with a unique id in the</span>
<span class="sd">    raster</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_in:</span>
<span class="sd">        Raster with single-pixels for which subcatchment should be determined</span>
<span class="sd">        &gt; 0: determine subcatchment</span>
<span class="sd">        = 0: don&#39;t determine subcatchments</span>
<span class="sd">    txt_routing_nonriver: str or pathlib.Path | str</span>
<span class="sd">        File path of the WaTEM/SEDEMrouting table</span>
<span class="sd">    resmap: str or pathlib.Path | str</span>
<span class="sd">        Folder path where results should be saved</span>
<span class="sd">    rasterprop: dict</span>
<span class="sd">        rasterio profile dictionary holding all metadata for geotiff rasters</span>
<span class="sd">    tag: str or pathlib.Path | str</span>
<span class="sd">        File path of output shape and raster</span>
<span class="sd">    catchment_name: str</span>
<span class="sd">        Name of catchment, default &quot;&quot;</span>
<span class="sd">    scenario_label: str, default &quot;&quot;</span>
<span class="sd">        Scenario number or letter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rst_subcatchments: str or pathlib.Path | str</span>
<span class="sd">        File path of raster with pixels beloging to a subcatchment having id</span>
<span class="sd">        equal to id sink in rst_in</span>
<span class="sd">    vct_subcatchments: str or pathlib.Path | str:</span>
<span class="sd">        File path of shapefile with polygon being the subcatchment having an</span>
<span class="sd">        id equal         to id sink in rst_in</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># txt = os.path.join(self.scenario.outfolder, &#39;routing.txt&#39;)</span>
    <span class="n">rst_subcatchments</span> <span class="o">=</span> <span class="n">resmap</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;subcatchments_</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">.sdat&quot;</span>
    <span class="n">vct_subcatchments</span> <span class="o">=</span> <span class="n">rst_subcatchments</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)</span>

    <span class="n">startvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">load_raster</span><span class="p">(</span><span class="n">rst_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">startvals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No values in input grid to define subcatchments!&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;saga_cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;-f=s&quot;</span><span class="p">,</span> <span class="s2">&quot;topology&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;-ROUTING&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">)]</span>
    <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-SEGMENTS&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rst_in</span><span class="p">)]</span>
    <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-CATCH&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rst_subcatchments</span><span class="p">)]</span>

    <span class="n">execute_saga</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">)</span>
    <span class="n">raster_to_polygon</span><span class="p">(</span><span class="n">rst_subcatchments</span><span class="p">,</span> <span class="n">vct_subcatchments</span><span class="p">)</span>
    <span class="n">create_spatial_index</span><span class="p">(</span><span class="n">vct_subcatchments</span><span class="p">)</span>
    <span class="n">gdf_subcatchments</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vct_subcatchments</span><span class="p">)</span>
    <span class="n">gdf_subcatchments</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;NAME&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gdf_subcatchments</span><span class="p">[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_subcatchments</span><span class="p">[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="n">gdf_subcatchments</span><span class="p">[</span><span class="s2">&quot;AREA_HA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_subcatchments</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="mf">10000.0</span>
    <span class="n">gdf_subcatchments</span> <span class="o">=</span> <span class="n">gdf_subcatchments</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">rasterprop</span><span class="p">[</span><span class="s2">&quot;epsg&quot;</span><span class="p">])</span>
    <span class="n">gdf_subcatchments</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">vct_subcatchments</span><span class="p">)</span>
    <span class="n">create_spatial_index</span><span class="p">(</span><span class="n">vct_subcatchments</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">rst_subcatchments</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="p">(</span><span class="n">rst_subcatchments</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;.sdat&quot;</span><span class="p">)),</span>
        <span class="n">vct_subcatchments</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="identify_individual_priority_catchments">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.identify_individual_priority_catchments">[docs]</a>
<span class="k">def</span> <span class="nf">identify_individual_priority_catchments</span><span class="p">(</span>
    <span class="n">arr_sediout</span><span class="p">,</span>
    <span class="n">rst_profile</span><span class="p">,</span>
    <span class="n">txt_routing_non_river</span><span class="p">,</span>
    <span class="n">nmax</span><span class="p">,</span>
    <span class="n">resmap</span><span class="o">=</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span>
    <span class="n">epsg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    identify the individual priority catchments and add them to a raster</span>
<span class="sd">    and shapes dictionary</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr_sediout: numpy.ndarray</span>
<span class="sd">        numpy array format of sedout raster</span>
<span class="sd">    rst_profile: rasterio profile</span>
<span class="sd">        rasterio profile of the sedout raster</span>
<span class="sd">    txt_routing_nonriver: str or pathlib.Path | str</span>
<span class="sd">        File path of the WaTEM/SEDEM routing table</span>
<span class="sd">    nmax: int</span>
<span class="sd">        maximum number of catchment</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    subcatchmentpriority: geopandas.GeoDataFrame</span>
<span class="sd">        catchment shapes with number of catchment</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># loop until break is encountered (no more pixels to cluster,</span>
    <span class="c1"># or a maximum number of clusters is reached)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="c1"># identify point with highest sediment load</span>
        <span class="n">id_</span><span class="p">,</span> <span class="n">max_sediout</span> <span class="o">=</span> <span class="n">create_id_raster_for_highest_value_arr</span><span class="p">(</span>
            <span class="n">arr_sediout</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">rst_profile</span><span class="p">,</span> <span class="n">resmap</span><span class="o">=</span><span class="n">resmap</span> <span class="o">/</span> <span class="s2">&quot;priority_catchments&quot;</span>
        <span class="p">)</span>

        <span class="c1"># identify subcatchment/cluster coupled to this point</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">resmap</span> <span class="o">/</span> <span class="s2">&quot;priority_catchments&quot;</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;subcatchments_priority_</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">.shp&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_name</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">rst_subcatch</span><span class="p">,</span> <span class="n">vct_subcatch</span> <span class="o">=</span> <span class="n">define_subcatchments_saga</span><span class="p">(</span>
                <span class="n">id_</span><span class="p">,</span> <span class="n">txt_routing_non_river</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">template_name</span>
            <span class="p">)</span>
            <span class="c1"># assign sediout value to self.subcatchmprioritSHP</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vct_subcatch</span><span class="p">)</span>
            <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;sediout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_sediout</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">vct_subcatch</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vct_subcatch</span> <span class="o">=</span> <span class="n">template_name</span>
            <span class="n">rst_subcatch</span> <span class="o">=</span> <span class="n">vct_subcatch</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.sdat&quot;</span><span class="p">)</span>

        <span class="c1"># condition: if a max number of clusters is identified</span>
        <span class="c1"># OR all pixels are classified: stop</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nmax</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_sediout</span> <span class="o">!=</span> <span class="n">rst_profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">nmax</span> <span class="o">=</span> <span class="n">n</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr_subcatch</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_subcatch</span><span class="p">)</span>
            <span class="n">arr_sediout</span><span class="p">[</span><span class="n">arr_subcatch</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">99999.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rst_profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># merge different subcatchments to one file</span>
    <span class="n">lst_gdf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;priority_catchments&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.shp&quot;</span><span class="p">:</span>
            <span class="n">lst_gdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">gdf_subcatchmpriority</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">lst_gdf</span><span class="p">)</span>

    <span class="n">gdf_subcatchmpriority</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="n">epsg</span><span class="p">}</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">resmap</span> <span class="o">/</span> <span class="s2">&quot;priority_catchments.shp&quot;</span>
    <span class="n">gdf_subcatchmpriority</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
    <span class="n">create_spatial_index</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf_subcatchmpriority</span></div>



<div class="viewcode-block" id="create_id_raster_for_highest_value_arr">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.create_id_raster_for_highest_value_arr">[docs]</a>
<span class="k">def</span> <span class="nf">create_id_raster_for_highest_value_arr</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">resmap</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a raster with an id value assigned to the highest value in the raster&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr: str or pathlib.Path | str</span>
<span class="sd">        with floats</span>
<span class="sd">    id_: int</span>
<span class="sd">        Sequential number of the catchment</span>
<span class="sd">    profile: rasterio profile</span>
<span class="sd">        Rasterio profile of the sedout raster</span>
<span class="sd">    resmap: str or pathlib.Path | str, optional</span>
<span class="sd">        Folder path to write results to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rst_id: str</span>
<span class="sd">        File path of the raster with id for highest value in raster</span>
<span class="sd">    val: float</span>
<span class="sd">        Maximum value in raster</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resmap</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">resmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resmap</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="p">(</span><span class="n">resmap</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">arr_id</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">==</span> <span class="n">max_val</span>
    <span class="n">arr_id</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_</span>
    <span class="n">arr_id</span><span class="p">[</span><span class="o">~</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span>

    <span class="c1"># write to disk</span>
    <span class="n">rst_id</span> <span class="o">=</span> <span class="n">resmap</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;id_</span><span class="si">{</span><span class="n">id_</span><span class="si">}</span><span class="s2">.rst&quot;</span>
    <span class="n">write_arr_as_rst</span><span class="p">(</span><span class="n">arr_id</span><span class="p">,</span> <span class="n">rst_id</span><span class="p">,</span> <span class="s2">&quot;int32&quot;</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rst_id</span><span class="p">,</span> <span class="n">max_val</span></div>



<div class="viewcode-block" id="remove_river_routing">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.remove_river_routing">[docs]</a>
<span class="k">def</span> <span class="nf">remove_river_routing</span><span class="p">(</span><span class="n">df_routing</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove river routing from routing dataframe</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df_routing: pandas.DataFrame</span>
<span class="sd">        Long format of routing table</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_routing</span>
<span class="sd">        Long format of routing table, with river routing removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_routing</span> <span class="o">=</span> <span class="n">df_routing</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_routing</span><span class="p">[</span><span class="s2">&quot;lnduSource&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;lnduSource&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lnduTarg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jump&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
        <span class="s2">&quot;targetX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;targetY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sourceX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sourceY&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">df_routing</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_routing</span></div>



<div class="viewcode-block" id="compute_efficiency_buffers">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.compute_efficiency_buffers">[docs]</a>
<span class="k">def</span> <span class="nf">compute_efficiency_buffers</span><span class="p">(</span><span class="n">rst_buffer</span><span class="p">,</span> <span class="n">rst_sediin</span><span class="p">,</span> <span class="n">rst_sediout</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute efficiency per buffer</span>

<span class="sd">    This function calculates the incoming and outgoing sediment per buffer.</span>
<span class="sd">    The deposition is computed by substracting the outgoing from the ingoing</span>
<span class="sd">    sediment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_buffer: str or pathlib.Path | str</span>
<span class="sd">        File path of buffer raster with buffer id&#39;s</span>
<span class="sd">    rst_sediin: str or ppathlib.Path | str</span>
<span class="sd">        File path of CNWS SediIn raster, incoming sediment per pixel</span>
<span class="sd">    rst_sediout: str or pathlib.Path | str</span>
<span class="sd">        File path of CNWS SediOut raster, outgoing sediment per pixel</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_output: pandas.DataFrame</span>
<span class="sd">        Holding results of mass balance of buffers.</span>

<span class="sd">        - *buf_id* (float): id of the buffer (as in the buffer raster)</span>
<span class="sd">        - *sediin* (float): total incoming sediment in the buffer.</span>
<span class="sd">        - *sediout* (float): total outgoing sediment in the buffer.</span>
<span class="sd">        - *buff_sed* (float): amount sediment deposited in the buffer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr_buffers</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_buffer</span><span class="p">)</span>
    <span class="n">arr_sediin</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_sediin</span><span class="p">)</span>
    <span class="n">arr_sediout</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_sediout</span><span class="p">)</span>

    <span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">,</span> <span class="s2">&quot;sediin&quot;</span><span class="p">,</span> <span class="s2">&quot;sediout&quot;</span><span class="p">,</span> <span class="s2">&quot;buff_sed&quot;</span><span class="p">])</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr_buffers</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr_buffers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">arr_unique_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr_buffers</span><span class="p">[</span><span class="n">condition</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">buf_id</span> <span class="ow">in</span> <span class="n">arr_unique_buffer</span><span class="p">:</span>
        <span class="n">arr_sediin_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_sediin</span><span class="p">[</span><span class="n">arr_buffers</span> <span class="o">==</span> <span class="n">buf_id</span><span class="p">])</span>
        <span class="n">arr_sediout_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_sediout</span><span class="p">[</span><span class="n">arr_buffers</span> <span class="o">==</span> <span class="n">buf_id</span><span class="p">])</span>
        <span class="n">arr_deposition</span> <span class="o">=</span> <span class="n">arr_sediin_buffer</span> <span class="o">-</span> <span class="n">arr_sediout_buffer</span>
        <span class="n">df_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">buf_id</span><span class="p">,</span>
            <span class="n">arr_sediin_buffer</span><span class="p">,</span>
            <span class="n">arr_sediout_buffer</span><span class="p">,</span>
            <span class="n">arr_deposition</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="k">return</span> <span class="n">df_out</span></div>



<div class="viewcode-block" id="open_txt_routing_file">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.open_txt_routing_file">[docs]</a>
<span class="k">def</span> <span class="nf">open_txt_routing_file</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open routing file with exceptions and seperators as needed</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    txt_routing: str or pathlib.Path | str</span>
<span class="sd">        File path of the WaTEM/SEDEM routing table</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_routing: pandas.DataFrame</span>
<span class="sd">        The routing DataFrame contains the following columns:</span>

<span class="sd">        - *col* (int): source column in rasters</span>
<span class="sd">        - *row* (int): source row in rasters</span>
<span class="sd">        - *target1col* (int): first target column in rasters</span>
<span class="sd">        - *target1row* (int): first target row in rasters</span>
<span class="sd">        - *part1* (float): Part that flows to target1</span>
<span class="sd">        - *distance1* (float): Distance of 1st vector</span>
<span class="sd">        - *target2col* (int): second target column in rasters</span>
<span class="sd">        - *target2row* (int): second target row in rasters</span>
<span class="sd">        - *part2* (float): Part that flows to target2</span>
<span class="sd">        - *distance2* (float): Distance of 2nd vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">seperator</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span> <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">first_line</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="n">df_routing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">txt_routing</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">seperator</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_routing</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt_routing</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is empty&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">txt_routing</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span>
        <span class="k">return</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_routing</span></div>



<div class="viewcode-block" id="create_erosion_raster">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.create_erosion_raster">[docs]</a>
<span class="k">def</span> <span class="nf">create_erosion_raster</span><span class="p">(</span><span class="n">rst_watereros</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create erosion raster from watereros.</span>

<span class="sd">    Extract negative values from Watereros raster and set positives to 0. Erosion</span>
<span class="sd">    values in this raster are positive (inverse of watereros)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_watereros: str or pathlib.Path | str</span>
<span class="sd">        File path to WaTEM/SEDEM watereros raster.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rst_erosion: pathlib.Path | str</span>
<span class="sd">        File path to pywatemsedem erosion raster.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rst_erosion</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rst_watereros</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;Erosion (kg).rst&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rst_erosion</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">arr_watereros</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_watereros</span><span class="p">)</span>
        <span class="n">arr_watereros</span><span class="p">[</span><span class="n">arr_watereros</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">arr_watereros</span><span class="p">[</span><span class="n">arr_watereros</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="n">arr_watereros</span><span class="p">[</span>
            <span class="n">arr_watereros</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">write_arr_as_rst</span><span class="p">(</span><span class="n">arr_watereros</span><span class="p">,</span> <span class="n">rst_erosion</span><span class="p">,</span> <span class="n">arr_watereros</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rst_erosion</span></div>



<div class="viewcode-block" id="create_deposition_raster">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.create_deposition_raster">[docs]</a>
<span class="k">def</span> <span class="nf">create_deposition_raster</span><span class="p">(</span><span class="n">rst_watereros</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create deposition raster from watereros.</span>

<span class="sd">    Extract positve values from Watereros raster and set negatives to 0</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_watereros: str or pathlib.Path | str</span>
<span class="sd">        File path to WaTEM/SEDEM watereros raster.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rst_deposition: pathlib.Path | str</span>
<span class="sd">        File path to pywatemsedem erosion raster.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rst_deposition</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rst_watereros</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;Deposition (kg).rst&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rst_deposition</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">arr_watereros</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_watereros</span><span class="p">)</span>
        <span class="n">arr_watereros</span><span class="p">[</span><span class="n">arr_watereros</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">arr_watereros</span><span class="p">[</span><span class="n">arr_watereros</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arr_watereros</span><span class="p">[</span>
            <span class="n">arr_watereros</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">write_arr_as_rst</span><span class="p">(</span><span class="n">arr_watereros</span><span class="p">,</span> <span class="n">rst_deposition</span><span class="p">,</span> <span class="n">arr_watereros</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rst_deposition</span></div>



<div class="viewcode-block" id="map_rank_sediment_loads">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.map_rank_sediment_loads">[docs]</a>
<span class="k">def</span> <span class="nf">map_rank_sediment_loads</span><span class="p">(</span>
    <span class="n">rst_sediexport</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">vct_out</span><span class="o">=</span><span class="s2">&quot;rank.shp&quot;</span><span class="p">,</span> <span class="n">rst_endpoints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rank the sediment loads in sediexport (and sewerin) from high to low</span>

<span class="sd">    This function uses the rank output raster/dataframe of</span>
<span class="sd">    :func:`pywatemsedem.io.modeloutput.identify_rank_sediment_loads`</span>
<span class="sd">    to map a vector point file with information on rank, sediment output.</span>

<span class="sd">    For computation details, see</span>
<span class="sd">    :func:`pywatemsedem.io.modeloutput.identify_rank_sediment_loads`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_sediexport: str or pathlib.Path | str</span>
<span class="sd">        File path of WaTEM/SEDEM sediexport raster.</span>
<span class="sd">    threshold: float</span>
<span class="sd">        See :func:`pywatemsedem.io.modeloutput.compute_cumulative_loads_in_sinks`</span>
<span class="sd">    vct_out: str or pathlib.Path | str</span>
<span class="sd">        File path of output vector.</span>
<span class="sd">    rst_endpoints: str or pathlib.Path | str, default None</span>
<span class="sd">        File path to WaTEM/SEDEM sewerin raster (endpoints in pywatemsedem).</span>
<span class="sd">    unit: str</span>
<span class="sd">        &quot;kg&quot; or &quot;ton&quot;</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Only points are taken into account that account for x of the highest sediment loads.</span>
<span class="sd">    x is determined by threshold.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kg&quot;</span><span class="p">,</span> <span class="s2">&quot;ton&quot;</span><span class="p">]:</span>
        <span class="sa">f</span><span class="s2">&quot;Unit &#39;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&#39; should be either &#39;kg&#39; op &#39;ton&#39;.&quot;</span>

    <span class="n">rst_out</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.rst&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    <span class="n">df_sediexport</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">identify_rank_sediment_loads</span><span class="p">(</span>
        <span class="n">rst_sediexport</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">rst_out</span><span class="p">,</span> <span class="n">rst_endpoints</span>
    <span class="p">)</span>
    <span class="n">rst_to_vct_points</span><span class="p">(</span><span class="n">rst_out</span><span class="p">,</span> <span class="n">vct_out</span><span class="p">)</span>
    <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vct_out</span><span class="p">)</span>
    <span class="n">gdf_out</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">rst_out</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">]</span>
    <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_sediexport</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;ton&quot;</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s2">&quot;sediexport&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="p">[</span><span class="s2">&quot;sediexport&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">rst_out</span><span class="p">),</span> <span class="s2">&quot;rst&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf_out</span></div>



<div class="viewcode-block" id="identify_rank_sediment_loads">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.identify_rank_sediment_loads">[docs]</a>
<span class="k">def</span> <span class="nf">identify_rank_sediment_loads</span><span class="p">(</span>
    <span class="n">rst_sediexport</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">rst_out</span><span class="p">,</span> <span class="n">rst_endpoints</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Identify the highest ``threshold`` percentage sediment loads.</span>

<span class="sd">    This functions identifies the cumulative distribution of the sediexport</span>
<span class="sd">    (and sewerin, optional) raster:</span>

<span class="sd">    - (optional) map sewerin  raster to sediexport raster</span>
<span class="sd">    - convert sediexport raster to a list-format</span>
<span class="sd">    - sort from high to low</span>
<span class="sd">    - compute cumulative distribution</span>
<span class="sd">    - classify</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rst_sediexport: str or pathlib.Path | str</span>
<span class="sd">        File path to WaTEM/SEDEM sediexport raster.</span>
<span class="sd">    threshold: float</span>
<span class="sd">        See :func:`pywatemsedem.io.modeloutput.compute_cumulative_loads_in_sinks`</span>
<span class="sd">    rst_out: str of pathlib.Path | str</span>
<span class="sd">        Output raster containing ranks of highest sediment loads (1: highest,</span>
<span class="sd">        2: second highest, ..)</span>
<span class="sd">    rst_endpoints: str or pathlib.Path | str</span>
<span class="sd">        File path to WaTEM/SEDEM sewerin raster.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_sediexport: pandas.DataFrame</span>
<span class="sd">        Data Frame format of SediExport raster (format: see</span>
<span class="sd">        :func:`pywatemsedem.pywatemsedem.utils.raster_array_to_pandas_dataframe`)</span>
<span class="sd">    threshold: float</span>
<span class="sd">        See :func:`pywatemsedem.io.modeloutput.compute_cumulative_loads_in_sinks`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr_sediexport</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_sediexport</span><span class="p">)</span>
    <span class="n">arr_sediexport</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_sediexport</span> <span class="o">==</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr_sediexport</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rst_endpoints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arr_sewerin</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">rst_endpoints</span><span class="p">)</span>
        <span class="n">arr_sewerin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_sewerin</span> <span class="o">==</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr_sewerin</span><span class="p">)</span>
        <span class="n">arr_sediexport</span> <span class="o">+=</span> <span class="n">arr_sewerin</span>

    <span class="n">df_sediexport</span> <span class="o">=</span> <span class="n">raster_array_to_pandas_dataframe</span><span class="p">(</span><span class="n">arr_sediexport</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
    <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GTiff&quot;</span>

    <span class="c1"># sort and select points</span>
    <span class="n">df_sediexport</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">compute_cumulative_loads_in_sinks</span><span class="p">(</span>
        <span class="n">df_sediexport</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">arr_sediexport</span> <span class="o">=</span> <span class="n">raster_dataframe_to_arr</span><span class="p">(</span><span class="n">df_sediexport</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">write_arr_as_rst</span><span class="p">(</span>
        <span class="n">arr_sediexport</span><span class="p">,</span>
        <span class="n">rst_out</span><span class="p">,</span>
        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
        <span class="n">profile</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df_sediexport</span><span class="p">,</span> <span class="n">threshold</span></div>



<div class="viewcode-block" id="compute_cumulative_loads_in_sinks">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.compute_cumulative_loads_in_sinks">[docs]</a>
<span class="k">def</span> <span class="nf">compute_cumulative_loads_in_sinks</span><span class="p">(</span>
    <span class="n">df_sediexport</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse cumulative sediment load by sorting SediExport values</span>
<span class="sd">    from high to low</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df_sediexport: pandas.DataFrame</span>
<span class="sd">        Data Frame format of SediExport raster (format: see</span>
<span class="sd">        :func:`pywatemsedem.pywatemsedem.utils.raster_array_to_pandas_dataframe`)</span>
<span class="sd">    profile: rasterio.profiles</span>
<span class="sd">        See :func:`rasterio.open`</span>
<span class="sd">    threshold: int</span>
<span class="sd">        x percentage highest load that the user wants to analyse</span>
<span class="sd">    delta: int</span>
<span class="sd">        Delta used to iterate percentage</span>
<span class="sd">    plot: bool, default False</span>
<span class="sd">        True if you want a cumulative SediExport plot</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df_sediexport: pandas.DataFrame</span>
<span class="sd">        Data Frame format of SediExport raster (format: see</span>
<span class="sd">        :func:`pywatemsedem.pywatemsedem.utils.raster_array_to_pandas_dataframe`) added</span>
<span class="sd">        with:</span>

<span class="sd">        - *cum_perc* (float): cumulative highest load</span>
<span class="sd">        - *perc* (float): percentage highest load</span>
<span class="sd">        - *class* (int): class as defined by `delta_perc`</span>

<span class="sd">    percentage: str</span>
<span class="sd">        updated percentage</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># sort according to values of sediment load into river</span>
    <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;sediexport&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>
    <span class="n">df_sediexport</span> <span class="o">=</span> <span class="n">df_sediexport</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;sediexport&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># calculate cumulative sum, in percentage</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;sediexport&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span>
    <span class="p">)</span>
    <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;cum_sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;sediexport&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">100</span>
        <span class="o">*</span> <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;cum_sum&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;sediexport&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_cumulative_sedimentload</span><span class="p">(</span>
            <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">],</span>
            <span class="n">threshold</span><span class="p">,</span>
            <span class="s2">&quot;cumulative_sediexport.png&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># hotfix on percentage: if the first percentage is higher than the</span>
    <span class="c1"># user-predefined percentage, adjust it (small catchments)!</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">verify_highest_load_with_threshold</span><span class="p">(</span><span class="n">df_sediexport</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

    <span class="c1"># prepare ids for subcatchment delineation</span>
    <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span>
    <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span>

    <span class="c1"># assign unique id&#39;s - in order of importance - to records</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="o">~</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># calculate percentage</span>
    <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;perc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_sediexport</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="c1"># chekc if begin percentage is below delta_perc</span>
    <span class="n">bperc</span> <span class="o">=</span> <span class="n">delta</span>
    <span class="n">eperc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bperc</span><span class="p">:</span>
        <span class="n">bperc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bperc</span><span class="p">,</span> <span class="n">eperc</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">df_sediexport</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">df_sediexport</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;perc&quot;</span><span class="p">,</span> <span class="s2">&quot;cum_perc&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;sediexport&quot;</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="p">),</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="verify_highest_load_with_threshold">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.verify_highest_load_with_threshold">[docs]</a>
<span class="k">def</span> <span class="nf">verify_highest_load_with_threshold</span><span class="p">(</span><span class="n">df_sediexport</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify whether that the highest load is not accountable for more than 50 percent</span>
<span class="sd">    of all the load in a catchment. If this is true, adapt threshold.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df_sediexport: pandas.DataFrame</span>
<span class="sd">        Data Frame format of SediExport raster (format: see</span>
<span class="sd">        :func:`pywatemsedem.pywatemsedem.utils.raster_array_to_pandas_dataframe`)</span>
<span class="sd">    threshold: float</span>
<span class="sd">        See :func:`pywatemsedem.io.modeloutput.compute_cumulative_loads_in_sinks`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    threshold_: float</span>
<span class="sd">        Adapted threshold (depending on if-else clause).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cum_sum_sinks0</span> <span class="o">=</span> <span class="n">df_sediexport</span><span class="p">[</span><span class="s2">&quot;cum_perc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">cum_sum_sinks0</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">threshold_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">cum_sum_sinks0</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Highest load is accountable for more than </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> percent of the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;total sediment load. Adapting percentage to </span><span class="si">{</span><span class="n">threshold_</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">threshold_</span> <span class="o">=</span> <span class="n">threshold</span>
    <span class="k">return</span> <span class="n">threshold_</span></div>



<div class="viewcode-block" id="load_total_sediment_file">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.load_total_sediment_file">[docs]</a>
<span class="k">def</span> <span class="nf">load_total_sediment_file</span><span class="p">(</span><span class="n">txt_total_sediment_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the total sediment file of CNWS written in CNWS dict_output map</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    txt_total_sediment_file: str or pathlib.Path | str</span>
<span class="sd">        File Path of the sediment file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict_output: dict</span>
<span class="sd">        The dict_output sediment data dictionary contains the following data:</span>

<span class="sd">        - *erosion* (float): total amount of erosion (kg)</span>
<span class="sd">        - *deposition* (float): total amount of deposition (kg)</span>
<span class="sd">        - *river* (float): total amount of sediment run-off to the river (kg)</span>
<span class="sd">        - *outside_domain* (float): total amount of sediment run-off out of the \</span>
<span class="sd">        catchment (kg)</span>
<span class="sd">        - *buffers* (float): total amount of sediment trapped in buffers (kg)</span>
<span class="sd">        - *endpoints* (float): total sewer of sediment trapped in sewers and \</span>
<span class="sd">        ditches (kg)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_total_sediment_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">Lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">dict_output</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">Lines</span><span class="p">:</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="c1"># hardcode</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Total erosion:&quot;</span><span class="p">:</span>
            <span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;erosion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Total deposition:&quot;</span><span class="p">:</span>
            <span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;deposition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Sediment leaving the catchment, via the river:&quot;</span><span class="p">:</span>
            <span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;river&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Sediment leaving the catchment, not via the river:&quot;</span><span class="p">:</span>
            <span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;outside_domain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Sediment trapped in buffers:&quot;</span><span class="p">:</span>
            <span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;buffers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;Sediment entering sewer system:&quot;</span><span class="p">:</span>
            <span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;endpoints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">dict_output</span></div>



<div class="viewcode-block" id="check_segment_edges">
<a class="viewcode-back" href="../../../api/pywatemsedem.io.html#pywatemsedem.io.modeloutput.check_segment_edges">[docs]</a>
<span class="k">def</span> <span class="nf">check_segment_edges</span><span class="p">(</span><span class="n">adj_edges</span><span class="p">,</span> <span class="n">up_edges</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check river segment their edges. All the segments present in adj_edges</span>
<span class="sd">    and up_edges must be present in the array from the segments raster.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    adj_edges: pandas.DataFrame</span>
<span class="sd">        Loaded adjacent edges text file, see :ref:`here &lt;watemsedem:adjsegments&gt;`</span>
<span class="sd">    up_edges: pandas.DataFrame</span>
<span class="sd">        Loaded up edges text file, see :ref:`here &lt;watemsedem:upstrsegments&gt;`</span>
<span class="sd">    arr: numpy.ndarray</span>
<span class="sd">        Segment raster array</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    adj_edges: pandas.DataFrame</span>
<span class="sd">        Filtered</span>
<span class="sd">    up_edges: pandas.DataFrame</span>
<span class="sd">        Filtered</span>
<span class="sd">    filt: bool</span>
<span class="sd">        Flag indicating filtering of dataframes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uniq_segm_rst</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
    <span class="n">uniq_segm_ue</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">up_edges</span><span class="p">[</span><span class="s2">&quot;upstream_line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">uniq_segm_e</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">up_edges</span><span class="p">[</span><span class="s2">&quot;line_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">uniq_segm_from</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">adj_edges</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">uniq_segm_to</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">adj_edges</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">uniq_segm_ue</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;More segments in the up edges table than in the raster, filtering&quot;</span> <span class="s2">&quot;table.&quot;</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">up_edges</span> <span class="o">=</span> <span class="n">up_edges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">up_edges</span><span class="p">[</span><span class="s2">&quot;upstream_line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">)]</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">uniq_segm_e</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;More segments in the up edges table than in the raster, filtering&quot;</span> <span class="s2">&quot;table.&quot;</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">up_edges</span> <span class="o">=</span> <span class="n">up_edges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">up_edges</span><span class="p">[</span><span class="s2">&quot;line_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">)]</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">uniq_segm_from</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;More segments in the adjacent edges table than in the raster, &quot;</span>
            <span class="s2">&quot;filtering table.&quot;</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">adj_edges</span> <span class="o">=</span> <span class="n">adj_edges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adj_edges</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">)]</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">uniq_segm_to</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;More segments in the adjacent edges table than in the raster, &quot;</span>
            <span class="s2">&quot;filtering table.&quot;</span>
        <span class="p">)</span>
        <span class="n">adj_edges</span> <span class="o">=</span> <span class="n">adj_edges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adj_edges</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uniq_segm_rst</span><span class="p">)]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">adj_edges</span><span class="p">,</span> <span class="n">up_edges</span><span class="p">,</span> <span class="n">filt</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fluves.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>