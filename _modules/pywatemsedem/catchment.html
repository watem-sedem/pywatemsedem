<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pywatemsedem.catchment &mdash; pywatemsedem 0.0.1a7 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=fbdb9ebb" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=aae18673"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pywatemsedem
          </a>
              <div class="version">
                0.0.1a7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">pywatemsedem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">Module Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/api.html">Data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/calibrate.html">Calibrating WaTEM/SEDEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/geo.html">Processing rasters and vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/userchoices.html">User Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/io.html">IO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Development guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html#package-release">Package release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../codeofconduct.html">Code of conduct</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pywatemsedem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pywatemsedem.catchment</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pywatemsedem.catchment</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">pywatemsedem.defaults</span> <span class="kn">import</span> <span class="n">SAGA_FLAGS</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.geo.factory</span> <span class="kn">import</span> <span class="n">Factory</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.geo.rasterproperties</span> <span class="kn">import</span> <span class="n">RasterProperties</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.geo.rasters</span> <span class="kn">import</span> <span class="n">RasterMemory</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.geo.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">any_equal_element_in_vector</span><span class="p">,</span>
    <span class="n">clean_up_tempfiles</span><span class="p">,</span>
    <span class="n">create_spatial_index</span><span class="p">,</span>
    <span class="n">define_extent_from_vct</span><span class="p">,</span>
    <span class="n">execute_subprocess</span><span class="p">,</span>
    <span class="n">load_raster</span><span class="p">,</span>
    <span class="n">read_rasterio_profile</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.io.folders</span> <span class="kn">import</span> <span class="n">CatchmentFolder</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.io.modeloutput</span> <span class="kn">import</span> <span class="n">check_segment_edges</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.tools</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">format_forced_routing</span><span class="p">,</span>
    <span class="n">get_df_area_unique_values_array</span><span class="p">,</span>
    <span class="n">zip_folder</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">attribute_discrete_value_error</span><span class="p">,</span> <span class="n">raster_discrete_value_error</span>
<span class="kn">from</span> <span class="nn">.valid</span> <span class="kn">import</span> <span class="n">valid_req_property</span>

<span class="c1"># from .valid import valid_req_property</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="valid_dtm">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.valid_dtm">[docs]</a>
<span class="k">def</span> <span class="nf">valid_dtm</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if you have defined a DTM.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please first define a DTM!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_river">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.valid_vct_river">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_river</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if you have defined a river vector.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define river vector!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_infra_line">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.valid_vct_infra_line">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_infra_line</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if infrastructure vectors are defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define infrastructure line vector!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_infra_poly">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.valid_vct_infra_poly">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_infra_poly</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if infrastructure vectors are defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define infrastructure polygon vector!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_parcels">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.valid_vct_parcels">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_parcels</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if infrastructure vectors are defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define parcels polygon vector!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="Catchment">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.Catchment">[docs]</a>
<span class="k">class</span> <span class="nc">Catchment</span><span class="p">(</span><span class="n">Factory</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a new Catchment instance</span>

<span class="sd">    The catchment class holds all static information for a catchment.</span>
<span class="sd">    The class considers all data of which the content is user-option-independent (i.e.</span>
<span class="sd">    :class:`pywatemsedem.userchoices.UserChoices`.</span>

<span class="sd">    Following properties can be set:</span>

<span class="sd">        - *kfactor*: K-factor raster.</span>
<span class="sd">        - *landuse*: base landuse raster.</span>
<span class="sd">        - *river*: river line vector.</span>
<span class="sd">        - *water*: water polygon vector</span>
<span class="sd">        - *vct_infrastructure_buildings*: polygon vector of infrastructure</span>
<span class="sd">          (typically buildings).</span>
<span class="sd">        - *vct_infrastructure_roads*: roads line vector (with optional attribute</span>
<span class="sd">          &#39;paved&#39;).</span>
<span class="sd">        - *cnsoil*: cn soil raster (CN-only).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Initialisation of mask, vector and raster handling is done with the help of the</span>
<span class="sd">    pywatemsedem factory class, see :class:`pywatemsedem.geo.factory.Factory`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">vct_catchment</span><span class="p">,</span>
        <span class="n">rst_dtm</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">,</span>
        <span class="n">epsg_code</span><span class="p">,</span>
        <span class="n">nodata</span><span class="p">,</span>
        <span class="n">results_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str</span>
<span class="sd">            Name of the catchment.</span>
<span class="sd">        vct_catchment: str or pathlib.Path</span>
<span class="sd">            Vector file of catchment outline (mask). This should be a single polygon</span>
<span class="sd">            vector.</span>
<span class="sd">        resolution: int</span>
<span class="sd">            Spatial resolution (m)</span>
<span class="sd">        epsg_code: int</span>
<span class="sd">            EPSG-code</span>
<span class="sd">        nodata: float</span>
<span class="sd">            Nodata-value</span>
<span class="sd">        results_folder: str | pathlib.Path, default None</span>
<span class="sd">            Folder path to write results to. If None, write to current folder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># prepare catchment</span>
        <span class="k">if</span> <span class="n">results_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Setting results folder to </span><span class="si">{</span><span class="p">(</span><span class="n">results_folder</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">CatchmentFolder</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">results_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># initiate factory</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">epsg_code</span><span class="p">,</span> <span class="n">nodata</span><span class="p">,</span> <span class="n">results_folder</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># if the binary mask of the catchment is a geopandas dataframe, map it first</span>
        <span class="c1"># to a file</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">vct_catchment</span><span class="p">)</span> <span class="ow">is</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_catchment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">vct_folder</span> <span class="o">/</span> <span class="s2">&quot;catchment.shp&quot;</span>
            <span class="n">vct_catchment</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vct_catchment</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_catchment</span> <span class="o">=</span> <span class="n">vct_catchment</span>
        <span class="c1"># input your own raster properties and do not self-generate them.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_rasterproperties</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># get RasterProperties from catchment vector and bounds DTM</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="n">read_rasterio_profile</span><span class="p">(</span><span class="n">rst_dtm</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">RasterProperties</span><span class="o">.</span><span class="n">from_rasterio</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rp</span> <span class="o">=</span> <span class="n">define_extent_from_vct</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_catchment</span><span class="p">,</span>
            <span class="n">resolution</span><span class="p">,</span>
            <span class="n">nodata</span><span class="p">,</span>
            <span class="n">epsg_code</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># set mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_catchment</span>

        <span class="c1"># set dtm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtm</span> <span class="o">=</span> <span class="n">rst_dtm</span>

        <span class="c1"># attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pfactor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrosoilgroup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_water</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># set name and logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># set other attributes to none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_river</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_tubed_river</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent_edges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_up_edges</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Catchment.zip">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.Catchment.zip">[docs]</a>
    <span class="k">def</span> <span class="nf">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Zip catchment folder&quot;&quot;&quot;</span>
        <span class="n">zip_folder</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">/</span> <span class="s2">&quot;Data_Bekken&quot;</span><span class="p">))</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter dtm raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Float64 raster with DTM height values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtm</span>

    <span class="nd">@dtm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dtm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign digital elevation model raster</span>

<span class="sd">        The DTM input should contain valid DTM raster values in meter a.s.l.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input: Pathlib.Path, str or numpy.array</span>
<span class="sd">            File path/array digital terrain model (m).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster_input</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">filter_within_parcels</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Filter dtm within parcel boundaries&quot;&quot;&quot;</span>
            <span class="n">temp_landuse</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.rst&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">temp_dtm_in</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.rst&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">temp_dtm</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.sgrd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp_dtm_in</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parcels</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp_landuse</span><span class="p">)</span>

            <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;saga_cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;-f=s&quot;</span><span class="p">,</span> <span class="s2">&quot;watem&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]</span>
            <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-DEM&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_dtm_in</span><span class="p">)]</span>
            <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-PRC&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_landuse</span><span class="p">)]</span>
            <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-DEM_FILTER&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_dtm</span><span class="p">)]</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;failed to filter_within_parcels dtm&quot;</span>
            <span class="n">execute_subprocess</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dtm</span><span class="o">.</span><span class="n">_arr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_raster</span><span class="p">(</span><span class="n">temp_dtm</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.sdat&quot;</span><span class="p">))</span>
            <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">temp_landuse</span><span class="p">,</span> <span class="s2">&quot;tiff&quot;</span><span class="p">)</span>
            <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">temp_dtm</span><span class="p">,</span> <span class="s2">&quot;saga&quot;</span><span class="p">)</span>
            <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">temp_dtm_in</span><span class="p">,</span> <span class="s2">&quot;rst&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dtm</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">filter_within_parcels</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;P-factor raster</span>

<span class="sd">        The P-factor raster holds values between 0 and 1, and is the factor in the</span>
<span class="sd">        RUSLE equation which takes into account erosion control. In pywatemsedem, this</span>
<span class="sd">        factor is always set to 1, as erosion source-oriented control measures are</span>
<span class="sd">        accounted for in the C-factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter K-factor raster</span>

<span class="sd">        The K-factor raster is a raster holding K-values for every pixel</span>
<span class="sd">        (:math:`\\frac{ton.h}{MJ.mm}`).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span>

    <span class="nd">@kfactor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">kfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign K-factor raster</span>

<span class="sd">        The K-factor raster is a raster holding K-values for every pixel</span>
<span class="sd">        (:math:`\\frac{ton.h}{MJ.mm}`). Negative no nodata values are set to zero.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input: Pathlib.Path, str or numpy.array</span>
<span class="sd">            File path/array K-factor raster (:math:`\\frac{ton.h}{MJ.mm}`) with K-values</span>
<span class="sd">            (see K-factor in RUSLE equation).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. The input requires as unit: :math:`\\frac{ton.h}{MJ.mm}`, whereas the output</span>
<span class="sd">           unit is :math:`\\frac{kg.h}{MJ.mm}`.</span>
<span class="sd">        2. The input data is rounded to kg (no decimals) by a conversion to int32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span>
            <span class="n">raster_input</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span>
        <span class="n">cond_neg</span> <span class="o">=</span> <span class="n">cond</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_neg</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Negative values detected in K-factor raster, setting negative &quot;</span>
                <span class="s2">&quot;values to 0.&quot;</span>
            <span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="n">cond_neg</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="n">cond</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kfactor</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hydrological_soil_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;CN hydrological soil group raster</span>

<span class="sd">        This raster (int) holds the four categories (see [2]_):</span>

<span class="sd">        - *A* (value 1): Soils in this group have low runoff potential when thoroughly</span>
<span class="sd">          wet.</span>
<span class="sd">        - *B* (value 2): Soils in this group have moderately low runoff potential when</span>
<span class="sd">          thoroughly wet.</span>
<span class="sd">        - *C* (value 3): Soils in this group have moderately high runoff potential when</span>
<span class="sd">          thoroughly wet.</span>
<span class="sd">        - *D* (value 4): Soils in this group have high runoff potential when thoroughly</span>
<span class="sd">          wet.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hydrosoilgroup</span>

    <span class="nd">@hydrological_soil_group</span><span class="o">.</span><span class="n">setter</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;dtm&quot;, mandatory=True)</span>
    <span class="k">def</span> <span class="nf">hydrological_soil_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign CN soil raster</span>

<span class="sd">        This raster (int) holds the four categories (see [2]_):</span>

<span class="sd">        - *A* (value 1): Soils in this group have low runoff potential when thoroughly</span>
<span class="sd">          wet.</span>
<span class="sd">        - *B* (value 2): Soils in this group have moderately low runoff potential when</span>
<span class="sd">          thoroughly wet.</span>
<span class="sd">        - *C* (value 3): Soils in this group have moderately high runoff potential when</span>
<span class="sd">          thoroughly wet.</span>
<span class="sd">        - *D* (value 4): Soils in this group have high runoff potential when thoroughly</span>
<span class="sd">          wet.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input: Pathlib.Path, str or numpy.array</span>
<span class="sd">            File path/array base landuse raster (class) with values *1*: A, *2*: B,</span>
<span class="sd">            *3*: C and *4*: D.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] NRCS, 2004. Hydrologic soil-cover complexes (chapter 9).</span>
<span class="sd">        .. [2] NRCS, 2009. Hydrologic soil groups (chapter 7).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hydrosoilgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span>
            <span class="n">raster_input</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">raster_discrete_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hydrosoilgroup</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
            <span class="s2">&quot;Hydrological soil group&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hydrosoilgroup</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;nodata&quot;</span><span class="p">,</span>
                <span class="s2">&quot;A: Soils with low runoff potential when thoroughly wet.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;B: Soils with moderately low runoff potential when thoroughly wet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;C: Soils with moderately high runoff potential when thoroughly wet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;D: Soils with high  runoff potential when thoroughly wet&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter background land-use raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            The raster can following values:</span>

<span class="sd">            - *nodata*: nodata</span>
<span class="sd">            - *-5*: open water</span>
<span class="sd">            - *-4*: grass</span>
<span class="sd">            - *-3*: forest</span>
<span class="sd">            - *-2*: infrastructure</span>
<span class="sd">            - *10*: agricultural fields</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span>

    <span class="nd">@landuse</span><span class="o">.</span><span class="n">setter</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;dtm&quot;, mandatory=True)</span>
    <span class="k">def</span> <span class="nf">landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign background land-use raster</span>

<span class="sd">        Raster should contain:</span>

<span class="sd">            - *-9999*: nodata</span>
<span class="sd">            - *-5*: open water</span>
<span class="sd">            - *-4*: grass</span>
<span class="sd">            - *-3*: forest</span>
<span class="sd">            - *-2*: infrastructure</span>
<span class="sd">            - *10*: agricultural fields</span>

<span class="sd">        Rasters with values outside this range return an error.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input: Pathlib.Path, str or numpy.array</span>
<span class="sd">            File path/array base landuse raster (class) with values *-9999*: nodata,</span>
<span class="sd">            *-5*: open water, *-4*: grass, *-3*: forest, *-2*: infrastructure, *10*:</span>
<span class="sd">            agricultural fields.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span>
            <span class="n">raster_input</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">raster_discrete_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
            <span class="s2">&quot;Landuse&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;nodata&quot;</span><span class="p">,</span>
                <span class="s2">&quot;grass strips&quot;</span><span class="p">,</span>
                <span class="s2">&quot;open water&quot;</span><span class="p">,</span>
                <span class="s2">&quot;grass&quot;</span><span class="p">,</span>
                <span class="s2">&quot; forest&quot;</span><span class="p">,</span>
                <span class="s2">&quot;infrastructure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;agricultural fields&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plotting fun&quot;&quot;&quot;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

            <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;#64cf1b&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#3b7db4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#71b651&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#387b00&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#00bfff&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;#a47158&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nodata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">arr</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                <span class="n">img</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;Grass strips (-6)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Pools (-5)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Meadow (-4)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Forest (-3)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Infrastructure (-2)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;River (-1)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Outside boundaries (0)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Agriculture (&gt;0)&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_landuse</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

<div class="viewcode-block" id="Catchment.create_height_contours">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.Catchment.create_height_contours">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_height_contours</span><span class="p">(</span><span class="n">rst_input</span><span class="p">,</span> <span class="n">vct_output</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create height contours line vector based on a DTM raster</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rst_input: pathlib.Path</span>
<span class="sd">            Input DTM raster</span>
<span class="sd">        vct_output: pathlib.Path</span>
<span class="sd">            Output height contour line vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rst_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">vct_output</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;saga_cmd&quot;</span><span class="p">,</span> <span class="n">SAGA_FLAGS</span><span class="p">,</span> <span class="s2">&quot;shapes_grid&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">]</span>
                <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="s2">&quot;-GRID&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">rst_input</span><span class="p">),</span>
                    <span class="s2">&quot;-CONTOUR&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">vct_output</span><span class="p">),</span>
                    <span class="s2">&quot;-ZSTEP&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">execute_subprocess</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;corrupted size vs. prev_size in fastbins&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">vct_output</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">fiona</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DriverError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">create_spatial_index</span><span class="p">(</span><span class="n">vct_output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Inputfile is not valid!&quot;</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">catchment_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total area of the catchment</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float: :math:`m^2`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_catchment</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">area</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_river&quot;, mandatory=True)</span>
    <span class="k">def</span> <span class="nf">river_segment_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total length of all river segments in the catchment</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float, meter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_river&quot;, mandatory=True)</span>
    <span class="k">def</span> <span class="nf">river</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter river raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Raster containing following values:</span>

<span class="sd">            - *-1*: river</span>
<span class="sd">            - *0*: no river</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_river</span><span class="o">.</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_river</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">RasterMemory</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_river&quot;, mandatory=False)</span>
    <span class="k">def</span> <span class="nf">adjacent_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter dataframe adjacent edges/segment property</span>

<span class="sd">        This property is generated by assigning a river line vector to the catchment</span>
<span class="sd">        class. Every row indicates a connection between two segments: segment *from*</span>
<span class="sd">        (column 1) flows into segment to (column 2). See :ref:`here &lt;watemsedem:adjsegments&gt;`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            With columns, flow</span>

<span class="sd">                - *from* (int): from segment</span>
<span class="sd">                - *to* (int): to segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent_edges</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_river&quot;, mandatory=False)</span>
    <span class="k">def</span> <span class="nf">up_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter dataframe upstream edges/segment property</span>

<span class="sd">        This property is generated by assigning a river line vector to the catchment</span>
<span class="sd">        class. See :ref:`here &lt;watemsedem:upstrsegments&gt;`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            With columns</span>

<span class="sd">                - *edge* (int): segment id</span>
<span class="sd">                - *upstream edge* (int): segment id of one of the upstream segment of</span>
<span class="sd">                  the edge.</span>
<span class="sd">                - *proportion* (float): proportion of upstream edge flowing into edge.</span>
<span class="sd">                  Lower than 1 when upstream edge flows into two edges.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_up_edges</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_river</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign river-line vector</span>

<span class="sd">        The river vector should be a line-vector file. No specific attributes should be</span>
<span class="sd">        defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Line vector file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span>

    <span class="nd">@vct_river</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign river-line vector</span>

<span class="sd">        The river vector should be a line-vector file. No specific attributes should be</span>
<span class="sd">        defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Line vector file. With optional</span>

<span class="sd">                - *underground* (int): does river section run underground</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># clip</span>
        <span class="n">vct_river_clipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">vct_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;river_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.shp&quot;</span>
        <span class="c1"># remove temporary files</span>
        <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">vct_river_clipped</span><span class="p">,</span> <span class="s2">&quot;shp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vct_river_clipped</span><span class="p">)</span>

        <span class="c1"># set topologize</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preparing river topology...&quot;</span><span class="p">)</span>
        <span class="n">vct_river_topo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">vct_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;topology_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.shp&quot;</span>
        <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">vct_river_topo</span><span class="p">,</span> <span class="s2">&quot;shp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent_edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_up_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topologize_river</span><span class="p">(</span>
            <span class="n">vct_river_clipped</span><span class="p">,</span> <span class="n">vct_river_topo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_raster</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vct_river_topo</span><span class="p">,</span> <span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">river</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="s2">&quot;line_id&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_river</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">river</span><span class="p">,</span> <span class="n">allow_nodata_array</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent_edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_up_edges</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">check_segment_edges</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacent_edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_river</span><span class="o">.</span><span class="n">arr</span>
        <span class="p">)</span>

        <span class="c1"># set routing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">routing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_river</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span>
                <span class="n">convert_lines_to_direction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">routing</span><span class="p">[</span><span class="n">routing</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">routing</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;River input vector is empty, setting river routing to None&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_tubed_river</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign underground river-line vector</span>

<span class="sd">        The river tubed vector should be a line-vector file. No specific</span>
<span class="sd">        attributes should be defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Line vector file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_tubed_river</span>

    <span class="nd">@vct_tubed_river</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_tubed_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign underground river-line vector</span>

<span class="sd">        The river tubed vector should be a line-vector file. No specific</span>
<span class="sd">        attributes should be defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Line vector file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_req_property</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">current_property</span><span class="o">=</span><span class="s2">&quot;vct_tubed_river&quot;</span><span class="p">,</span>
            <span class="n">req_property_name</span><span class="o">=</span><span class="s2">&quot;vct_river&quot;</span><span class="p">,</span>
            <span class="n">mandatory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;A vector is assigned to tubed rivers, please &quot;</span>
            <span class="s2">&quot;set &#39;Force Routing&#39; in model option equal to 1.&quot;</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">vct_tubed_river</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_tubed_river</span> <span class="o">=</span> <span class="n">format_forced_routing</span><span class="p">(</span>
            <span class="n">vct_tubed_river</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">gdal_profile</span><span class="p">[</span><span class="s2">&quot;minmax&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_river</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">any_equal_element_in_vector</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vct_river</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">vct_tubed_river</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">geometry</span>
            <span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Lines in the river (tubed) vector are also present in the &quot;</span>
                    <span class="s2">&quot;river vector. Please remove overlapping vectors.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter river routing raster</span>

<span class="sd">        See :ref:`here &lt;watemsedem:riverroutingmap&gt;`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster or None</span>
<span class="sd">            Raster containing values from 0 to 8:</span>

<span class="sd">            - *0*: do not route further</span>
<span class="sd">            - *1*: route to upper pixel</span>
<span class="sd">            - *2*: route to upper right pixel</span>
<span class="sd">            - *3*: route to right pixel</span>
<span class="sd">            - *4*: route to lower right pixel</span>
<span class="sd">            - *5*: route to lower pixel</span>
<span class="sd">            - *6*: route to lower left pixel</span>
<span class="sd">            - *7*: route to left pixel</span>
<span class="sd">            - *8*: route to upper left pixel</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_river&quot;, mandatory=False)</span>
    <span class="k">def</span> <span class="nf">segments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter river segments raster</span>

<span class="sd">        See :ref:`here &lt;watemsedem:riversegmentfile&gt;`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Raster containing following values:</span>

<span class="sd">            - *&gt;0*: segment_id</span>
<span class="sd">            - *-9999*: nodata</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The number of segments is limited to int16.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_river</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_river</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span> <span class="n">allow_nodata_array</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span>

<div class="viewcode-block" id="Catchment.topologize_river">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.Catchment.topologize_river">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">topologize_river</span><span class="p">(</span>
        <span class="n">vct_input</span><span class="p">,</span>
        <span class="n">vct_output</span><span class="p">,</span>
        <span class="n">rst_mask</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare topology of the river segments with SAGA-GIS</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vct_input: str or pathlib.Path</span>
<span class="sd">            Line input vector</span>
<span class="sd">        vct_output: str of pathlib.Path</span>
<span class="sd">            Topologized line output vector</span>
<span class="sd">        rst_mask: str or pathlib.Path</span>
<span class="sd">            Mask raster (used for mapping)</span>
<span class="sd">        tolerance: float</span>
<span class="sd">            If not None, the ``TOLERANCE`` command line argument of the saga topology</span>
<span class="sd">            command is given this value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        adjacent_edges: pandas.DataFrame</span>
<span class="sd">           See :func:`pywatemsedem.catchment.Catchment.adjacent_edges` and</span>
<span class="sd">           :ref:`here &lt;watemsedem:adjsegments&gt;`.</span>
<span class="sd">        up_edges: pandas.DataFrame</span>
<span class="sd">            See :func:`pywatemsedem.catchment.Catchment.up_edges` and</span>
<span class="sd">            :ref:`here &lt;watemsedem:upstrsegments&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;saga_cmd&quot;</span><span class="p">,</span> <span class="n">SAGA_FLAGS</span><span class="p">,</span> <span class="s2">&quot;topology&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]</span>
        <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-INPUTLINES&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vct_input</span><span class="p">)]</span>
        <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-OUTPUTLINES&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vct_output</span><span class="p">)]</span>
        <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-SYSTEM&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rst_mask</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">tolerance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-TOLERANCE&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)]</span>

        <span class="n">temp_adjacent_edges</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="n">temp_up_edges</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># temp fix</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">execute_subprocess</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;corrupted size vs. prev_size in fastbins&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">vct_output</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">fiona</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DriverError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;saga_cmd&quot;</span><span class="p">,</span> <span class="n">SAGA_FLAGS</span><span class="p">,</span> <span class="s2">&quot;topology&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]</span>
        <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-INPUTLINES&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vct_output</span><span class="p">)]</span>
        <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-ADJECANT_EDGES&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_adjacent_edges</span><span class="p">)]</span>
        <span class="n">cmd_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-UPSTREAM_EDGES&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_up_edges</span><span class="p">)]</span>

        <span class="c1"># temp fix</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">execute_subprocess</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;corrupted size vs. prev_size in fastbins&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_adjacent_edges</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_up_edges</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">fiona</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DriverError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">adjacent_edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_adjacent_edges</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">up_edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_up_edges</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">temp_up_edges</span><span class="p">),</span> <span class="s2">&quot;txt&quot;</span><span class="p">)</span>
        <span class="n">clean_up_tempfiles</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">temp_adjacent_edges</span><span class="p">),</span> <span class="s2">&quot;txt&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">adjacent_edges</span><span class="p">,</span> <span class="n">up_edges</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_water</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter water polygon vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.vectors.AbstractVector</span>
<span class="sd">            Polygon vector with attribute &quot;value&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span>

    <span class="nd">@vct_water</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_water</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign water polygon vector</span>

<span class="sd">        The water vector should be a polygon-vector file. No specific attributes should</span>
<span class="sd">        be defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Polygon vector file</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Water is mapped to the value of -5 and considered as a sink for sediment in</span>
<span class="sd">        WaTEM/SEDEM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_water&quot;, mandatory=False)</span>
    <span class="k">def</span> <span class="nf">water</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter water polygon vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Raster containing following values:</span>

<span class="sd">            - *-5*: open water</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">float</span>
        <span class="p">)</span>
        <span class="n">water</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_water</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_infrastructure_buildings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter infrastructure polygon vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.vectors.AbstractVector</span>
<span class="sd">            Polygon vector with attribute &quot;paved&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span>

    <span class="nd">@vct_infrastructure_buildings</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_infrastructure_buildings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign infrastructure polygon vector</span>

<span class="sd">        The infrastructure buildings vector should be polygon vector. Buildings are</span>
<span class="sd">        defined as all non-road elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Polygon vector file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;paved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(</span>
    <span class="c1">#    req_property_name=&quot;vct_infrastructure_buildings&quot;, mandatory=False</span>
    <span class="c1"># )</span>
    <span class="k">def</span> <span class="nf">infrastructure_buildings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter rasterized infrastructure polygon vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Raster containing following values:</span>

<span class="sd">            - *-2*: paved</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span>
            <span class="s2">&quot;paved&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;paved&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">infra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_buildings</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;paved&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">infra</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="c1"># @valid_req_property(req_property_name=&quot;vct_infrastructure_roads&quot;, mandatory=False)</span>
    <span class="k">def</span> <span class="nf">infrastructure_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter rasterized infrastructure polygon vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Raster containing following values:</span>

<span class="sd">            - *-2*: paved</span>
<span class="sd">            - *-7*: paved</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span>
            <span class="s2">&quot;paved&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;paved&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;paved&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_infrastructure_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter infrastructure line vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span>

    <span class="nd">@vct_infrastructure_roads</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_infrastructure_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign infrastructure line vector</span>

<span class="sd">        The infrastructure roads vector should be polygon vector. Paved and non-paved</span>
<span class="sd">        roads can be defined:</span>

<span class="sd">            - *-2*: paved</span>
<span class="sd">            - *-7*: non-paved</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Line vector file with allowed (optional) column &#39;paved&#39;: allowed values -2</span>
<span class="sd">            (paved) and -7 (non-paved).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;LineString&quot;</span><span class="p">)</span>
        <span class="n">geodata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span><span class="o">.</span><span class="n">geodata</span>
        <span class="k">if</span> <span class="s2">&quot;paved&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span><span class="o">.</span><span class="n">geodata</span><span class="p">:</span>
            <span class="n">attribute_discrete_value_error</span><span class="p">(</span>
                <span class="n">geodata</span><span class="p">,</span>
                <span class="s2">&quot;Infrastucture roads&quot;</span><span class="p">,</span>
                <span class="s2">&quot;paved&quot;</span><span class="p">,</span>
                <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;nodata&quot;</span><span class="p">,</span> <span class="s2">&quot;paved&quot;</span><span class="p">,</span> <span class="s2">&quot; non-paved&quot;</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;paved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_infrastructure_roads</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="n">geodata</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">infrastructure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get infrastucture raster</span>

<span class="sd">        Get rasterized polygon and line vectors. The procedure adds the line data</span>
<span class="sd">        (roads) to the  polygon data (buildings). As such buildings are considered as</span>
<span class="sd">        the base map.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Raster containing following values:</span>

<span class="sd">            - *-2*: paved</span>
<span class="sd">            - *-7*: paved</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Note that current module allows to either define a roads (1), buildings (2)</span>
<span class="sd">        or roads and buildings (3). If no roads or buildings are defined, an error is</span>
<span class="sd">        thrown.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_roads</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_buildings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_roads</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">arr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_buildings</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">cond1</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_roads</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span>
                <span class="n">cond2</span> <span class="o">=</span> <span class="n">arr2</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_buildings</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">,</span> <span class="n">arr2</span><span class="p">,</span> <span class="n">arr1</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">arr</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_buildings</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span> <span class="o">=</span> <span class="n">RasterMemory</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_roads</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_buildings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infrastructure_buildings</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;First define infrastructure lines (roads) or/and polygons &quot;</span>
                    <span class="s2">&quot;(buildings) before calling infrastructure property!&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plotting fun&quot;&quot;&quot;</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Plot infrastructure&quot;&quot;&quot;</span>
            <span class="n">arr_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nodata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_plot</span> <span class="o">!=</span> <span class="n">nodata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arr_plot</span><span class="p">)</span>
                <span class="n">arr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_plot</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>

            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arr_plot</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infrastructure</span>

    <span class="k">def</span> <span class="nf">_calculate_soil_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate statistics of K-factor map</span>

<span class="sd">        Calculates the area (m²) and the relative amount of appearance of</span>
<span class="sd">        every K-factor in the catchment. The results are written to a csv-file</span>
<span class="sd">        &quot;K_factor_stats_[resolution].csv&quot; in ``self.cfolder.rst_folder ``.</span>

<span class="sd">        #TODO</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">rst_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;K_factor_stats_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Calculating K-factor statistics&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">get_df_area_unique_values_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kfactor</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_area</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rel_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_area</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="Catchment.create_folder_structure">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.catchment.Catchment.create_folder_structure">[docs]</a>
    <span class="k">def</span> <span class="nf">create_folder_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a fixed folder structure for the model data</span>

<span class="sd">        The folder layout will have the following directory structure:</span>

<span class="sd">        ::</span>

<span class="sd">            ├── homefolder</span>
<span class="sd">            │    └── bekken folder / catchment folder</span>
<span class="sd">            │         ├── Rsts</span>
<span class="sd">            │         ├── Shps</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aanmaken folderstructuur bekken...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">CatchmentFolder</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fluves.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>