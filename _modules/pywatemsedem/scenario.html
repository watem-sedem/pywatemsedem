<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pywatemsedem.scenario &mdash; pywatemsedem 0.0.1a4.post1.dev1+gb8c23a5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=fbdb9ebb" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=2bb187b8"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pywatemsedem
          </a>
              <div class="version">
                0.0.1a4.post1.dev1+gb8c23a5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">pywatemsedem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">Module Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/api.html">Data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/calibrate.html">Calibrating WaTEM/SEDEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/geo.html">Processing rasters and vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/userchoices.html">User Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/io.html">IO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Development guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html#package-release">Package release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../codeofconduct.html">Code of conduct</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pywatemsedem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pywatemsedem.scenario</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pywatemsedem.scenario</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Standard libraries</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pywatemsedem.cfactor</span> <span class="kn">import</span> <span class="n">create_cfactor_cnws</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.cn</span> <span class="kn">import</span> <span class="n">process_cn_raster</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.geo.rasters</span> <span class="kn">import</span> <span class="n">RasterMemory</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.geo.utils</span> <span class="kn">import</span> <span class="n">nearly_identical</span><span class="p">,</span> <span class="n">saga_intersection</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.io.folders</span> <span class="kn">import</span> <span class="n">ScenarioFolders</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.io.ini</span> <span class="kn">import</span> <span class="n">IniFile</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.ktc</span> <span class="kn">import</span> <span class="n">create_ktc_cnws</span>
<span class="kn">from</span> <span class="nn">pywatemsedem.parcelslanduse</span> <span class="kn">import</span> <span class="n">ParcelsLanduse</span><span class="p">,</span> <span class="n">get_source_landuse</span>

<span class="kn">from</span> <span class="nn">.buffers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">filter_outlets_in_arr_extension_id</span><span class="p">,</span>
    <span class="n">process_buffer_outlets</span><span class="p">,</span>
    <span class="n">process_buffers_in_river</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">attribute_continuous_value_error</span><span class="p">,</span>
    <span class="n">attribute_discrete_value_error</span><span class="p">,</span>
    <span class="n">missing_attribute_error_in_vct</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.grasstrips</span> <span class="kn">import</span> <span class="n">create_grassstrips_cnws</span>
<span class="kn">from</span> <span class="nn">.templates</span> <span class="kn">import</span> <span class="n">InputFileName</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="n">format_forced_routing</span><span class="p">,</span> <span class="n">zip_folder</span>

<span class="n">inputfilename</span> <span class="o">=</span> <span class="n">InputFileName</span><span class="p">()</span>
<span class="n">DEFAULT_CFACTOR</span> <span class="o">=</span> <span class="mf">0.37</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="valid_vct_endpoints">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_vct_endpoints">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_endpoints</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if endpoints vector are defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;Include sewers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Please define endpoints line vector (see &quot;</span>
                    <span class="s2">&quot;vct_endpoints-property) or set &#39;Include sewers&#39; in &quot;</span>
                    <span class="s2">&quot;&#39;dict_model_options&#39; to 0!!&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s2">&quot;SewerInletEff&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define a &#39;SewerInletEff&#39; in &#39;dict_variables&#39;.&quot;</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define &#39;Include sewers&#39; in &#39;dict_model_options&#39; to 1.&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_parcels">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_vct_parcels">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_parcels</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if parcels vector are defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define parcels polygon vector (see vct_parcels-property)!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_source_measure">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_vct_source_measure">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_source_measure</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if source measure vector are defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_source_measure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Please define source measure polygon vector (see &quot;</span>
                <span class="s2">&quot;vct_source_measure-property)!&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_grass_strips">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_vct_grass_strips">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_grass_strips</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if grass strips vector is defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;UseGras&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No grass strips defined, but option &#39;UseGras&#39; equal to 1.&quot;</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_buffers">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_vct_buffers">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_buffers</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if buffers vector is defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include buffers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No buffers defined, but option &#39;Include buffers&#39; equal to 1.&quot;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_vct_outlets">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_vct_outlets">[docs]</a>
<span class="k">def</span> <span class="nf">valid_vct_outlets</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if outlet vector is defined&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define outlets point vector (see vct_outlets-property)!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_dtm">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_dtm">[docs]</a>
<span class="k">def</span> <span class="nf">valid_dtm</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if you have defined a DTM.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">dtm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please first define a DTM!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_kfactor">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_kfactor">[docs]</a>
<span class="k">def</span> <span class="nf">valid_kfactor</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if you have defined a K-factor raster.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">kfactor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please first define a K-factor raster!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_pfactor">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_pfactor">[docs]</a>
<span class="k">def</span> <span class="nf">valid_pfactor</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if you have defined a P-factor raster.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">pfactor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please first define a P-factor raster!&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_cnws_input">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_cnws_input">[docs]</a>
<span class="k">def</span> <span class="nf">valid_cnws_input</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;CN-WS&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Please create a valid CN-raster with *prepare_cnws_model_input*&quot;</span>
                    <span class="s2">&quot; for a WaTEM/SEDEM run.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ktc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;UserProvidedKTC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Please create a valid kTC-raster with *prepare_cnws_model_input*.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfactor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Please create a valid c-factor-raster with &quot;</span>
                <span class="s2">&quot;*prepare_cnws_model_input*.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">composite_landuse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Please define a WaTEM/SEDEM-landuse-raster with &quot;</span>
                <span class="s2">&quot;*prepare_cnws_model_input*.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="valid_ini">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.valid_ini">[docs]</a>
<span class="k">def</span> <span class="nf">valid_ini</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if you have defined a valid ini-file.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define an ini-file with *create_ini_file*.&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="CNWSException">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.CNWSException">[docs]</a>
<span class="k">class</span> <span class="nc">CNWSException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception from WaTEM/SEDEM pre- and postprocessing scripts&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Scenario">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario">[docs]</a>
<span class="k">class</span> <span class="nc">Scenario</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a new Scenario instance</span>

<span class="sd">    The catchment class holds all dynamic information for a scenario, for a given year.</span>
<span class="sd">    The class considers all data of which the content is user-option-dependent (i.e.</span>
<span class="sd">    :class:`pywatemsedem.userchoices.UserChoices`.</span>

<span class="sd">    - *vct_parcels*: polygon vector of parcels with obligated columns &#39;LANDUSE&#39;,</span>
<span class="sd">      &#39;C_crop&#39; and &#39;CODE&#39;.</span>
<span class="sd">    - *vct_grass_strips*: polygon vector of grass stips with obligated columns</span>
<span class="sd">      &#39;scale_ktc&#39; and &#39;width&#39;.</span>
<span class="sd">    - *vct_buffers*: polygon vector of grass stips with obligated columns &#39;buffercap&#39;</span>
<span class="sd">      (CN), &#39;hdam&#39; (CN), &#39;hknijp&#39; (CN), &#39;dknijp&#39; (CN), &#39;qcoef&#39; (CN), &#39;boverl&#39; (CN),</span>
<span class="sd">      &#39;eff&#39; (WS).</span>
<span class="sd">    - *vct_bufferoutlets*: #TODO</span>
<span class="sd">    - *vct_outlets*: point vector.</span>
<span class="sd">    - *vct_ditches*: #TODO</span>
<span class="sd">    - *vct_conductive_dams*: #TODO</span>
<span class="sd">    - *vct_force_routing*: line vector.</span>
<span class="sd">    - *vct_endpoints*: line vector, with optional columns &#39;efficiency&#39; and &#39;type_id&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catchm</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">scenario_nr</span><span class="p">,</span> <span class="n">userchoices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate scenario instance with catchment, year, scenario number and user</span>
<span class="sd">        choices.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        catchm: pywatemsedem.core.catchment.Catchment</span>
<span class="sd">            Instance of :class:`pywatemsedem catchment &lt;pywatemsedem.catchment.Catchment&gt;`</span>
<span class="sd">            containing the catchment characteristics.</span>
<span class="sd">        year: int</span>
<span class="sd">            Simulation year</span>
<span class="sd">        scenario_nr: int</span>
<span class="sd">            Identifier number of the scenario.</span>
<span class="sd">        userchoices : pywatemsedem.core.userchoices.UserChoices</span>
<span class="sd">            Containing the pywatemsedem model settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Init factories from catchm instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span> <span class="o">=</span> <span class="n">catchm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">rp</span>

        <span class="c1"># Initalize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vector_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">raster_factory</span>

        <span class="c1"># properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grass_strips</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># raster</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_bufferoutlets</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_ditches</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_condictive_dams</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_source_measures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_force_routing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># derivate properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ktc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cn_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cfactor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_composite_landuse</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># assign scenario number and user choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span> <span class="o">=</span> <span class="n">scenario_nr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">userchoices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rst_outlet</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ini</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># initialisation functionalities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_resolution</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_folder_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_data_layers_to_scenario_folder</span><span class="p">()</span>

<div class="viewcode-block" id="Scenario.create_folder_structure">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.create_folder_structure">[docs]</a>
    <span class="k">def</span> <span class="nf">create_folder_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;#TODO&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_folder_init</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">home_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;scenario_&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span> <span class="o">=</span> <span class="n">ScenarioFolders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span></div>


<div class="viewcode-block" id="Scenario.copy_data_layers_to_scenario_folder">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.copy_data_layers_to_scenario_folder">[docs]</a>
    <span class="nd">@valid_kfactor</span>
    <span class="nd">@valid_dtm</span>
    <span class="nd">@valid_pfactor</span>
    <span class="k">def</span> <span class="nf">copy_data_layers_to_scenario_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;#TODO&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">kfactor</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">kfactor_file</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">dtm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">dtm_file</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">99999</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">pfactor</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">pfactor_file</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">adjacent_edges</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">adjacentedges_file</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">up_edges</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">upedges_file</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;River Routing&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_output</span><span class="p">[</span><span class="s2">&quot;Output per river segment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">routing_file</span>
            <span class="p">)</span>
        <span class="c1"># if self.choices.dict_output[&quot;Output per river segment&quot;] == 1:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">segments_file</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">mask_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.temporal_resolution">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.temporal_resolution">[docs]</a>
    <span class="k">def</span> <span class="nf">temporal_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates for which years and seasons the scenario needs data.</span>

<span class="sd">        Based on the defined choices in the</span>
<span class="sd">        :py:class:`CNWS.UserChoices &lt;pywatemsedem.CNWS.UserChoices&gt;` &#39;begin_jaar&#39;,</span>
<span class="sd">        &#39;begin_maand&#39; and, in case of CNWS, &#39;Endtime model&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;WS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;Only Routing&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="s2">&quot;spring&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;begin_maand&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="s2">&quot;winter&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;begin_maand&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="s2">&quot;spring&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;begin_maand&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="s2">&quot;summer&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;begin_maand&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="s2">&quot;fall&quot;</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_parcels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter parcels polygon vector&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span>

    <span class="nd">@vct_parcels</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_parcels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign parcels polygon vector</span>

<span class="sd">        The parcels vector should be polygon vector. Should contain a definition of</span>
<span class="sd">        land-use (column &quot;LANDUSE&quot;):</span>

<span class="sd">            - *-4*: grass land</span>
<span class="sd">            - *-3*: forest</span>
<span class="sd">            - *-2*: infrastructure (farms)</span>
<span class="sd">            - *-9999*: agricultural land</span>

<span class="sd">        Should contain a definition of crop code (column &quot;CODE&quot;).</span>

<span class="sd">        Should contain a definition of the crop C-factor (column &#39;C_crop&#39;, see</span>
<span class="sd">        :ref:`here &lt;watemsedem:cmap&gt;`.):</span>

<span class="sd">            - *[0,1]*: C-factor for crop.</span>
<span class="sd">            - *NULL*: no C-factor defined.</span>

<span class="sd">        Should contain a defiction of the C-reduction (column &#39;C_reduction&#39;), used</span>
<span class="sd">        in case of source-oriented measures.</span>

<span class="sd">        Can contain a &#39;NR&#39; column which is the identification ID of the individual</span>
<span class="sd">        parcel.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Polygon vector</span>

<span class="sd">            - *LANDUSE* (int): landuse value (-4: grass land, -3: forest,</span>
<span class="sd">               -2: infrastructure (farms), -9999: agricultural land).</span>
<span class="sd">            - *C_crop* (float): C-factor for crop, valid for considered time period</span>
<span class="sd">              ([0,1], NULL-values allowed).</span>
<span class="sd">            - *NR* (int, optional): id.</span>
<span class="sd">            - *C_reduction* (float): C-reduction values,  C-factor is reduced with this</span>
<span class="sd">              percentage when source-oriented measures are used.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The C-value for crops are defined as the C-factor that is valid as value for</span>
<span class="sd">        the coupled crop given a time period (e.g. average C-factor for potato for one</span>
<span class="sd">        year, or average C-factor for potato for the month April).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">missing_attribute_error_in_vct</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
            <span class="s2">&quot;Parcels&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;C_crop&quot;</span><span class="p">,</span> <span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="s2">&quot;LANDUSE&quot;</span><span class="p">,</span> <span class="s2">&quot;C_reduct&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">attribute_continuous_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Parcels&quot;</span><span class="p">,</span> <span class="s2">&quot;C_crop&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">attribute_continuous_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Parcels&quot;</span><span class="p">,</span> <span class="s2">&quot;C_reduct&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">attribute_discrete_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
            <span class="s2">&quot;Parcels&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LANDUSE&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">},</span>
            <span class="n">classes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;agriculture&quot;</span><span class="p">,</span> <span class="s2">&quot;infrastructure&quot;</span><span class="p">,</span> <span class="s2">&quot;forest&quot;</span><span class="p">,</span> <span class="s2">&quot;grass land&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;NR&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">),</span> <span class="mi">1</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;LANDUSE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span>
            <span class="s2">&quot;LANDUSE&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parcels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parcels raster</span>

<span class="sd">        Raster contains id&#39;s (defined in &quot;NR&quot;, if not defined: according to</span>
<span class="sd">        id sequence in vector). The parcel raster is limited by the value of 32767</span>
<span class="sd">        (int16). If values are higher, then these are limited to 32767.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Int16 raster with values:</span>

<span class="sd">            - *&gt;0 and &lt;=32767*: parcel id</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels_ids</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Parcels raster has values higher than the maximum allowed number &quot;</span>
                    <span class="s2">&quot;for WaTEM/SEDEM definition (i.e. 32767). Setting values above &quot;</span>
                    <span class="s2">&quot;32767 to 32767.&quot;</span>
                <span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parcels_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter rasterized parcels polygon vector</span>

<span class="sd">        Raster contains id&#39;s (defined in &quot;NR&quot;, if not defined: according to</span>
<span class="sd">        id sequence in vector).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster, else None</span>
<span class="sd">            Float64 raster with values:</span>

<span class="sd">            - *&gt;0*: parcel id</span>
<span class="sd">            - *-9999*: nodata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NR&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parcels_landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter rasterized parcels polygon vector</span>

<span class="sd">        Raster contains landuse (defined in column &quot;LANDUSE&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster, else None</span>
<span class="sd">            Float64 raster with values:</span>

<span class="sd">            - *-4*: grass land</span>
<span class="sd">            - *-3*: forest</span>
<span class="sd">            - *-2*: infrastructure (farms)</span>
<span class="sd">            - *-9999*: agricultural land</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If all parcels have a landuse code of -9999, then a None is returned</span>
<span class="sd">        (no addition to landuse).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_parcels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_parcels</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;LANDUSE&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_grass_strips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter grass strips polygon vector&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span>

    <span class="nd">@vct_grass_strips</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_grass_strips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign grass strips polygon vector</span>

<span class="sd">        Grass strips are appointed the value -6 in the WaTEM/SEDEM parcels landuse</span>
<span class="sd">        raster. In addition, C-factors and kTC-values are assigned to grass strips</span>
<span class="sd">        pixels according to their width, see also</span>
<span class="sd">        :func:`pywatemsedem.cfactor.create_cfactor_cnws` and</span>
<span class="sd">        :func:`pywatemsedem.ktc.create_ktc_cnws`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Polygon vector</span>

<span class="sd">            - *width* (int): meter width of grass strip (shortest side!)</span>
<span class="sd">            - *scale_ktc* (int): either 0 (scale or 1), if not kTC is not scaled, then</span>
<span class="sd">              the ktc_low (see :class:`pywatemsedem.userchoices.UserChoices`) is used,</span>
<span class="sd">              see :func:`pywatemsedem.ktc.scale_ktc_gdf_grass_strips`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Grass strips are defined by a length and a width, the width is considered to be</span>
<span class="sd">        the shortest side, whereas the length is considerd to be the longest side.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">)</span>
        <span class="n">missing_attribute_error_in_vct</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Grass strips&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;scale_ktc&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">attribute_continuous_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Grass strips&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">attribute_discrete_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
            <span class="s2">&quot;Grass strips&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scale_ktc&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
            <span class="n">classes</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;do not scale ktc grass strip according to width&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scale ktc according to width&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;NR&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">_geodata</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">_geodata</span><span class="p">),</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_grass_strips</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span>
            <span class="s2">&quot;NR&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_grass_strips</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NR&quot;</span><span class="p">,</span>
            <span class="n">nodata</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span>
            <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grass_strips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@valid_vct_grass_strips</span>
    <span class="k">def</span> <span class="nf">grass_strips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Grass strips raster getter&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;UseGras&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;&#39;UseGras&#39; in &#39;dict_ecm_options&#39; is equal to 0. Will not include grass&quot;</span>
                <span class="s2">&quot; strips.&quot;</span>
            <span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grass_strips</span>

    <span class="nd">@grass_strips</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">grass_strips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Grass strips raster setter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input: Pathlib.Path, str or numpy.ndarray</span>
<span class="sd">            See :func:`pywatemsedem.catchment.raster_factory`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grass_strips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster_input</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter buffers polygon vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span>

    <span class="nd">@vct_buffers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign buffers polygon vector</span>

<span class="sd">        Buffers are considered in WaTEM/SEDEM as a raster defined by an id (outlet) and</span>
<span class="sd">        extension id (buffer extent, i.e. number of pixels surrounding the outlet). In</span>
<span class="sd">        addition, a number of properties of the buffers are assigned (i.e. &#39;buffercap&#39;,</span>
<span class="sd">        &#39;hdam&#39;, &#39;hknijp&#39;, &#39;dknijp&#39;, &#39;qcoef&#39;, &#39;boverl&#39;, &#39;eff&#39;).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Polygon vector, with columns</span>

<span class="sd">            - *id* (WS)</span>
<span class="sd">            - *buffercap* (CN)</span>
<span class="sd">            - *hdam* (CN)</span>
<span class="sd">            - *hknijp* (CN)</span>
<span class="sd">            - *dknijp* (CN)</span>
<span class="sd">            - *qcoef* (CN)</span>
<span class="sd">            - *boverl* (CN)</span>
<span class="sd">            - *eff* (WS)</span>

<span class="sd">            For an explanation of the columns, see :ref:`here &lt;watemsedem:buffermap&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">req_col</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;buffercap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hdam&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hknijp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dknijp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;qcoef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;boverl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eff&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">)</span>
        <span class="n">missing_attribute_error_in_vct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="n">req_col</span><span class="p">)</span>
        <span class="n">attribute_continuous_value_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;eff&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include buffers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Include buffers&#39; in &#39;dict_ecm_options&#39; is equal to 0. Will not &quot;</span>
                <span class="s2">&quot;include buffers.&quot;</span>
            <span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_bufferoutlets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter infrastructure polygon vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_bufferoutlets</span>

    <span class="nd">@vct_bufferoutlets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_bufferoutlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign buffer outlets vector</span>

<span class="sd">        #TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            See :func:`pywatemsedem.catchment.vector_factory`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_bufferoutlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@valid_vct_buffers</span>
    <span class="k">def</span> <span class="nf">buffers_exid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter buffer extension Id raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="mi">31370</span><span class="p">,</span> <span class="s2">&quot;buf_exid&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bufferoutlet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter buffer outlet raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_bufferoutlets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_bufferoutlets</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="n">process_buffer_outlets</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vct_bufferoutlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span>
            <span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vct_river</span><span class="o">.</span><span class="n">arr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bufferoutlet</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">dtm</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@valid_vct_buffers</span>
    <span class="k">def</span> <span class="nf">buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter for buffer</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Overlapping buffers with rivers (complete overlap) are removed.</span>
<span class="sd">        2. Buffer outlet vector can be used to define the buffer outlets, if not used</span>
<span class="sd">           then the pixel with the lowest DTM height value is used as outlet for a</span>
<span class="sd">           buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include buffers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Option &#39;Include buffers&#39; in erosion control measure options is 0, &quot;</span>
                <span class="s2">&quot;returning None&quot;</span>
            <span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include buffers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="n">assign_buffer_id_to_df_buffer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vct_river</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="n">process_buffers_in_river</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">buffers_exid</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">river</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">gdal_profile</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>  <span class="c1"># if all buffers are removed</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;All buffers pixels overlap with the river, removing and not &quot;</span>
                        <span class="s2">&quot;including buffers in simulation.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include buffers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">filter_outlets_in_arr_extension_id</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">dtm</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int16&quot;</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_ditches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter ditches lines vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_ditches</span>

    <span class="nd">@vct_ditches</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_ditches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter ditches lines vector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            See :func:`pywatemsedem.catchment.vector_factory`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_ditches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_conductive_dams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter conductive dams vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_condictive_dams</span>

    <span class="nd">@vct_conductive_dams</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_conductive_dams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter conductive dams lines vector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            See :func:`pywatemsedem.catchment.vector_factory`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_condictive_dams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Scenario.conductive_dams">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.conductive_dams">[docs]</a>
    <span class="k">def</span> <span class="nf">conductive_dams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter conductive dams</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.raster.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_conductive_dams</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span>
            <span class="n">convert_lines_to_direction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if there is a buffer on the same pixel of a ditch, remove the ditch</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffers</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vct_river</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river</span><span class="o">.</span><span class="n">arr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.ditches">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.ditches">[docs]</a>
    <span class="k">def</span> <span class="nf">ditches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter ditches</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.raster.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_ditches</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span>
            <span class="n">convert_lines_to_direction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if there is a buffer on the same pixel of a ditch, remove the ditch</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffers</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vct_river</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river</span><span class="o">.</span><span class="n">arr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter outlets vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span>

    <span class="nd">@vct_outlets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set vector outlet point</span>

<span class="sd">        With this setter, one can define the outlet point of a catchment. This outlet</span>
<span class="sd">        is reflected in the output of WaTEM/SEDEM (see</span>
<span class="sd">        :ref:`here &lt;watemsedem:totalsedimenttxt&gt;`).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Point vector, with optional column &#39;NR&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span><span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;Point&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Defined outlets are not in catchment.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;NR&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_outlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                    <span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vct_outlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_outlets</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="nb">float</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@valid_vct_outlets</span>
    <span class="k">def</span> <span class="nf">outlets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter outlets</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.raster.AbstractRaster</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_outlets</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NR&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span><span class="o">.</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outlets</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_force_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;#todo</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_force_routing</span>

    <span class="nd">@vct_force_routing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_force_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Appoint force routing</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: str | pathlib.Path | geopandas.GeoDataFrame</span>
<span class="sd">            See :func:`pywatemsedem.catchment.vector_factory`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vct_forced_routing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_force_routing</span> <span class="o">=</span> <span class="n">format_forced_routing</span><span class="p">(</span>
            <span class="n">vct_forced_routing</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">gdal_profile</span><span class="p">[</span><span class="s2">&quot;minmax&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vct_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter endpoints lines vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span>

    <span class="nd">@vct_endpoints</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vct_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign endpoints line vector</span>

<span class="sd">        Endpoints are defined as sink objects, in which sediment is captured and not</span>
<span class="sd">        transported further. The endpoints should be line vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            Line vector with optional column</span>

<span class="sd">            - *type_id* (int): describes the different classes of endpoints (e.g. 1:</span>
<span class="sd">              sewers, 2: ditches, ...)</span>
<span class="sd">            - *efficiency* (float): sediment trap efficiency (%) .</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. In the WaTEM/SEDEM pywatemsedem engine, endpoints are named &quot;sewers&quot;, see also</span>
<span class="sd">           :ref:`here &lt;watemsedem:sewermapfile&gt;`. Note that in pywatemsedem, type of endpoints can</span>
<span class="sd">           be defined (ditches, sewers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_factory</span><span class="p">(</span>
            <span class="n">vector_input</span><span class="p">,</span> <span class="s2">&quot;LineString&quot;</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;type_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No &#39;type_id&#39; assigned, assuming one type of endpoint with id 1.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="p">[</span><span class="s2">&quot;type_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;type_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please define a &#39;type_id&#39; for every record.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;efficiency&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attribute_continuous_value_error</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span> <span class="s2">&quot;Endpoints&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span>
            <span class="s2">&quot;efficiency&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@valid_vct_endpoints</span>
    <span class="k">def</span> <span class="nf">endpoints_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter endpoints id raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Float64 raster with values:</span>

<span class="sd">            - *0*: no endpoint</span>
<span class="sd">            - *not equal to 0*: id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_endpoints</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span> <span class="mi">31370</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;type_id&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">arr_id</span><span class="p">[</span><span class="n">arr_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr_id</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@valid_vct_endpoints</span>
    <span class="k">def</span> <span class="nf">endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter endpoints efficiency raster</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pywatemsedem.geo.rasters.AbstractRaster</span>
<span class="sd">            Float64 raster with values in [0,1] efficiency (in decimal).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Id&#39;s equal to one are converted to 0 when</span>
<span class="sd">        self.choices.dict_model_options[&quot;OnlyInfraSewers&quot;] is equal to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;efficiency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
            <span class="c1"># in decimals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;SewerInletEff&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;The efficiency is not defined for all sewer line strings, assigning&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; &#39;SewerInletEff&#39;-value defined in user choices &#39;variables&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s1">&#39;SewerInletEff&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2"> %).&quot;</span>
            <span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="s2">&quot;efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_endpoints</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span>
            <span class="s2">&quot;efficiency&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_endpoints</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask_raster</span><span class="p">,</span>
            <span class="mi">31370</span><span class="p">,</span>
            <span class="n">nodata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="s2">&quot;efficiency&quot;</span><span class="p">,</span>
            <span class="n">gdal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">arr</span><span class="p">[</span><span class="n">arr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;OnlyInfraSewers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoints_id</span><span class="o">.</span><span class="n">arr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cond_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">cond</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">cond_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">river</span><span class="o">.</span><span class="n">arr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cn_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set/getter CN-table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            with columns:</span>

<span class="sd">            - CNmaxID (int): unique identifier, compiled from CN type id (1-11,</span>
<span class="sd">              associated to crop), contour plowing measures (0/1/2), hydrological</span>
<span class="sd">              conditions ({0,1-&gt;3}, {unknown, poor to good}), contour_id (0/1).</span>
<span class="sd">            - CNmax_1 (int): CNmax for soil class 1</span>
<span class="sd">            - CNmax_2 (int): CNmax for soil class 2</span>
<span class="sd">            - CNmax_3 (int): CNmax for soil class 3</span>
<span class="sd">            - CNmax_4 (int): CNmax for soil class 4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cn_table</span>

    <span class="nd">@cn_table</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cn_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set/getter CN-table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            with columns:</span>

<span class="sd">            - CNmaxID (int): unique identifier, compiled from CN type id (1-11,</span>
<span class="sd">              associated to crop), contour plowing measures (0/1/2), hydrological</span>
<span class="sd">              conditions ({0,1-&gt;3}, {unknown, poor to good}), contour_id (0/1).</span>
<span class="sd">            - CNmax_1 (int): CNmax for soil class 1</span>
<span class="sd">            - CNmax_2 (int): CNmax for soil class 2</span>
<span class="sd">            - CNmax_3 (int): CNmax for soil class 3</span>
<span class="sd">            - CNmax_4 (int): CNmax for soil class 4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">{</span><span class="s2">&quot;CNmaxID&quot;</span><span class="p">,</span> <span class="s2">&quot;CNmax_1&quot;</span><span class="p">,</span> <span class="s2">&quot;CNmax_2&quot;</span><span class="p">,</span> <span class="s2">&quot;CNmax_3&quot;</span><span class="p">,</span> <span class="s2">&quot;CNmax_4&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Dataframe should have columns &#39;CNmaxID&#39;, &#39;CNmax_1&#39;, &#39;CNmax_2&#39;, &quot;</span>
                <span class="s2">&quot;&#39;CNmax_3&#39;, &#39;CNmax_4&#39;.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cn_table</span> <span class="o">=</span> <span class="n">df</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">composite_landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter infrastructure polygon vector&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_composite_landuse</span>

    <span class="nd">@composite_landuse</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">composite_landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign parcels polygon vector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_input: Pathlib.Path, str or geopandas.GeoDataFrame</span>
<span class="sd">            See :func:`pywatemsedem.catchment.vector_factory`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_composite_landuse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span>
            <span class="n">raster_input</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter cfactor 3-D raster&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfactor</span>

    <span class="nd">@cfactor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter cfactor 3-D raster</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input:</span>
<span class="sd">            3-D raster: x,y raster for every season.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster_input</span><span class="p">)</span>
        <span class="n">raster</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">arr</span> <span class="o">==</span> <span class="n">raster</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">raster</span><span class="o">.</span><span class="n">arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cfactor</span> <span class="o">=</span> <span class="n">raster</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ktc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter ktc 3-D raster&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ktc</span>

    <span class="nd">@ktc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ktc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter ktc 3-D raster</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input:</span>
<span class="sd">            3-D raster: x,y raster for every season.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ktc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster_input</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter cn 3-D raster&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cn</span>

    <span class="nd">@cn</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_input</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setter cn 3-D raster</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raster_input:</span>
<span class="sd">            3-D raster: x,y raster for every season.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_factory</span><span class="p">(</span><span class="n">raster_input</span><span class="p">,</span> <span class="n">flag_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="Scenario.prepare_grass_strips">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.prepare_grass_strips">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_grass_strips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maximize_grass_strips</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare grass strips array</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maximize_grass_strips: bool, default False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr_parcels</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels</span><span class="o">.</span><span class="n">arr</span>
            <span class="n">arr_grass_ids</span><span class="p">,</span> <span class="n">arr_grass</span> <span class="o">=</span> <span class="n">create_grassstrips_cnws</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">river</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">rasterio_profile</span><span class="p">,</span>
                <span class="n">arr_parcels</span><span class="o">=</span><span class="n">arr_parcels</span><span class="p">,</span>
                <span class="n">expand_grass_strips</span><span class="o">=</span><span class="n">maximize_grass_strips</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># write_ids</span>
            <span class="n">grass_ids</span> <span class="o">=</span> <span class="n">RasterMemory</span><span class="p">(</span><span class="n">arr_grass_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span>
            <span class="n">grass_ids</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">scenarioyear_folder</span>
                <span class="o">/</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;grasstripsID_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_s&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span><span class="si">}</span><span class="s2">.tif&quot;</span>
                <span class="p">),</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># grass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span> <span class="o">=</span> <span class="n">arr_grass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">scenarioyear_folder</span>
                <span class="o">/</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gras_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_s</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">),</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.create_perceelskaart_cnws">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.create_perceelskaart_cnws">[docs]</a>
    <span class="k">def</span> <span class="nf">create_perceelskaart_cnws</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rivers</span><span class="p">,</span>
        <span class="n">water</span><span class="p">,</span>
        <span class="n">infrastructure</span><span class="p">,</span>
        <span class="n">landuse</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">,</span>
        <span class="n">yearfolder</span><span class="p">,</span>
        <span class="n">rp</span><span class="p">,</span>
        <span class="n">grass_strips</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parcels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">landuse_parcels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create CN_WS perceelskaart according to format of :ref:`here &lt;watemsedem:prcmap&gt;`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rivers: numpy.ndarray</span>
<span class="sd">            River raster, should only contain nodata-value and -1 (river), see</span>
<span class="sd">            :ref:`here &lt;watemsedem:prcmap&gt;`.</span>
<span class="sd">        water: numpy.ndarray</span>
<span class="sd">            Water raster, should only contain nodata-value and -3 (), see</span>
<span class="sd">            :ref:`here &lt;watemsedem:prcmap&gt;`.</span>
<span class="sd">        infrastructure: numpy.ndarray</span>
<span class="sd">            Infrastructure raster, should only contain -2 (paved) and -7 (non-paved)</span>
<span class="sd">            and nodata-value. #TODO: check if we can only use -7</span>
<span class="sd">        landuse: numpy.ndarray</span>
<span class="sd">            Landuse raster. This raster should be formatted according to the composite</span>
<span class="sd">            landuse / WaTEM/SEDEM parcels raster (see :ref:`here &lt;watemsedem:prcmap&gt;`).</span>
<span class="sd">        mask: numpy.ndarray</span>
<span class="sd">            Mask raster,</span>
<span class="sd">        yearfolder: pathlib.Path</span>
<span class="sd">            #TODO: try to ditch this</span>
<span class="sd">        rp: pywatemsedem.geo.rasterproperties.RasterProperties</span>
<span class="sd">            Raster properties, see :class:`pywatemsedem.geo.rasterproperties.RasterProperties`</span>
<span class="sd">        grass_strips: numpy.ndarray</span>
<span class="sd">            Grass strips raster, can only contain nodata-value and -6 (see</span>
<span class="sd">            :ref:`here &lt;watemsedem:prcmap&gt;`).</span>
<span class="sd">        parcels: numpy.ndarray</span>
<span class="sd">            Parcels ids raster, can only containt nodata-value and &gt;0 (see</span>
<span class="sd">            :ref:`here &lt;watemsedem:prcmap&gt;`)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The infrastructur value -7 does not follow the definition of</span>
<span class="sd">        :ref:`here &lt;watemsedem:prcmap&gt;`. This value is converted in subfunctionalities of</span>
<span class="sd">        this function to -2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># parcels)</span>
        <span class="c1"># TODO</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxprc_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parcels</span><span class="o">.</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxprc_id</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># landuse</span>
        <span class="n">landuse_core</span> <span class="o">=</span> <span class="n">get_source_landuse</span><span class="p">(</span>
            <span class="n">landuse</span><span class="p">,</span>
            <span class="n">maxprc_id</span><span class="p">,</span>
            <span class="n">rp</span><span class="o">.</span><span class="n">rasterio_profile</span><span class="p">,</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="n">yearfolder</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">ParcelsLanduse</span><span class="p">(</span>
            <span class="n">landuse_core</span><span class="p">,</span>
            <span class="n">rivers</span><span class="p">,</span>
            <span class="n">water</span><span class="p">,</span>
            <span class="n">infrastructure</span><span class="p">,</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span>
            <span class="n">landuse_parcels</span><span class="o">=</span><span class="n">landuse_parcels</span><span class="p">,</span>
            <span class="n">parcels</span><span class="o">=</span><span class="n">parcels</span><span class="p">,</span>
            <span class="n">grass_strips</span><span class="o">=</span><span class="n">grass_strips</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">create_parcels_landuse_raster</span><span class="p">()</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>  <span class="c1"># aardewegen infstructuur maken</span>
        <span class="c1"># safety check, fill last empty gaps with 32767</span>
        <span class="n">arr</span><span class="p">[(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">32767</span>
        <span class="n">composite_landuse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">composite_landuse</span></div>


<div class="viewcode-block" id="Scenario.prepare_cnws_model_input">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.prepare_cnws_model_input">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_cnws_model_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maximize_grass_strips</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create model input for a scenario</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maximize_grass_strips: bool, default False</span>
<span class="sd">            See :func:`pywatemsedem.scenario.create_perceelskaart_cnws`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aanmaken van alle nodige modelinput...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_grass_strips</span><span class="p">(</span><span class="n">maximize_grass_strips</span><span class="o">=</span><span class="n">maximize_grass_strips</span><span class="p">)</span>

        <span class="n">arr_parcels_lu</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels_landuse</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels_landuse</span><span class="o">.</span><span class="n">arr</span>
        <span class="p">)</span>

        <span class="c1"># todo: how could we fix following lines?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr_grass_strips</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr_grass_strips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span><span class="o">.</span><span class="n">arr</span>
            <span class="n">arr_grass_strips</span><span class="p">[</span><span class="n">arr_grass_strips</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grass_strips</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span>

        <span class="n">arr_water</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vct_water</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">water</span><span class="o">.</span><span class="n">arr</span>

        <span class="n">arr_parcels</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parcels</span><span class="o">.</span><span class="n">arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">composite_landuse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_perceelskaart_cnws</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">river</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
            <span class="n">arr_water</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">landuse</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">arr_bin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">scenarioyear_folder</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">rp</span><span class="p">,</span>
            <span class="n">grass_strips</span><span class="o">=</span><span class="n">arr_grass_strips</span><span class="p">,</span>
            <span class="n">parcels</span><span class="o">=</span><span class="n">arr_parcels</span><span class="p">,</span>
            <span class="n">landuse_parcels</span><span class="o">=</span><span class="n">arr_parcels_lu</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">composite_landuse</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">parcelmosaic_file</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="s2">&quot;Only Routing&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_seasonal_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">composite_landuse</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">river</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">infrastructure</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">landuse</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                <span class="n">vct_parcels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vct_parcels</span><span class="p">,</span>
                <span class="n">vct_grass_strips</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vct_grass_strips</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;Manual outlet selection&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outlets</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">outlet_file</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="s2">&quot;Only Routing&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;Calibrate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;Write sediment export&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Write water erosion&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Output per river segment&quot;</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include buffers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffers</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">buffers_file</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include ditches&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ditches</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">ditches_file</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;Include dams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conductive_dams</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">conductivedams_file</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;FilterDTM&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Filtering DTM within boundaries of parcels.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">dtm</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">dtm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">dtm_file</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;Include sewers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endpoints</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">endpoints_file</span><span class="p">,</span>
                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;idrisi&quot;</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endpoints_id</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">endpoints_id_file</span><span class="p">,</span>
                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;idrisi&quot;</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.update_seasonal_data">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.update_seasonal_data">[docs]</a>
    <span class="k">def</span> <span class="nf">update_seasonal_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">composite_landuse</span><span class="p">,</span>
        <span class="n">river</span><span class="p">,</span>
        <span class="n">infrastructure</span><span class="p">,</span>
        <span class="n">landuse</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">,</span>
        <span class="n">vct_parcels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vct_grass_strips</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update seasonal data for prepare_cnws_model_input</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year: int</span>
<span class="sd">            Simulation year.</span>
<span class="sd">        cn_table:</span>
<span class="sd">            File path to CN table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># C-factor</span>
        <span class="n">vct_grass_strips</span><span class="p">,</span> <span class="n">cfactor</span> <span class="o">=</span> <span class="n">create_cfactor_cnws</span><span class="p">(</span>
            <span class="n">river</span><span class="p">,</span>
            <span class="n">infrastructure</span><span class="p">,</span>
            <span class="n">landuse</span><span class="p">,</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="p">,</span>
            <span class="n">vct_parcels</span><span class="o">=</span><span class="n">vct_parcels</span><span class="p">,</span>
            <span class="n">vct_grass_strips</span><span class="o">=</span><span class="n">vct_grass_strips</span><span class="p">,</span>
            <span class="n">use_source_oriented_measures</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_ecm_options</span><span class="p">[</span><span class="s2">&quot;UseTeelttechn&quot;</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfactor</span> <span class="o">=</span> <span class="n">cfactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfactor</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">cfactor_file</span><span class="p">)</span>

        <span class="c1"># CN</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;CN-WS&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cn</span><span class="p">,</span> <span class="n">gdf</span> <span class="o">=</span> <span class="n">process_cn_raster</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">hydrological_soil_group</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vct_parcels</span><span class="o">.</span><span class="n">geodata</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">composite_landuse</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parcels_ids</span><span class="o">.</span><span class="n">arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cn_table</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="s2">&quot;CN_table_parcels.shp&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">cn_file</span><span class="p">)</span>
        <span class="c1"># kTC</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_model_options</span><span class="p">[</span><span class="s2">&quot;UserProvidedKTC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">vct_grass_strips</span> <span class="o">=</span> <span class="n">create_ktc_cnws</span><span class="p">(</span>
                <span class="n">composite_landuse</span><span class="p">,</span>
                <span class="n">cfactor</span><span class="p">,</span>
                <span class="n">mask</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;ktc low&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;ktc high&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">dict_variables</span><span class="p">[</span><span class="s2">&quot;ktc limit&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="p">,</span>
                <span class="n">grass</span><span class="o">=</span><span class="n">vct_grass_strips</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># write results</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ktc</span> <span class="o">=</span> <span class="n">out</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ktc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="n">inputfilename</span><span class="o">.</span><span class="n">ktc_file</span><span class="p">)</span>
            <span class="c1"># write grass strips</span>
            <span class="k">if</span> <span class="n">vct_grass_strips</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vct_grass_strips</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">scenarioyear_folder</span>
                    <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;gras_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_s</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span><span class="si">}</span><span class="s2">.shp&quot;</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.create_ini_file">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.create_ini_file">[docs]</a>
    <span class="nd">@valid_cnws_input</span>
    <span class="k">def</span> <span class="nf">create_ini_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an ini-file for the scenario&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aanmaken ini-file...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span> <span class="o">/</span> <span class="s2">&quot;inifile.ini&quot;</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">IniFile</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsinput_folder</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">cnwsoutput_folder</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">add_model_information</span><span class="p">()</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">add_working_directories</span><span class="p">()</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">add_files</span><span class="p">()</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">add_user_choices</span><span class="p">()</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">add_output_maps</span><span class="p">()</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">add_variables</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span><span class="o">.</span><span class="n">geodata</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vct_buffers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vct_force_routing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catchm</span><span class="o">.</span><span class="n">vct_tubed_river</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ini</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ini</span><span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.run_model">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.run_model">[docs]</a>
    <span class="nd">@valid_ini</span>
    <span class="k">def</span> <span class="nf">run_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cnws_binary</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the WaTEM/SEDEM model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cnws_binary : str</span>
<span class="sd">            Name of CN_WS pascal compiled executable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modeling scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_nr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">cnws_binary</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ini</span><span class="p">)]</span>
            <span class="n">run</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd_args</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Modelrun finished!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to run CNWS-model&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Scenario.zip">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.Scenario.zip">[docs]</a>
    <span class="k">def</span> <span class="nf">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">zip_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfolder</span><span class="o">.</span><span class="n">scenario_folder</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="remove_known_grass_strips_from_parcels_vct_saga">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.remove_known_grass_strips_from_parcels_vct_saga">[docs]</a>
<span class="k">def</span> <span class="nf">remove_known_grass_strips_from_parcels_vct_saga</span><span class="p">(</span><span class="n">parcels</span><span class="p">,</span> <span class="n">vct_grass_strips</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove parcels with overlap above 75%</span>

<span class="sd">    Remove the parcels in vct_parcels that overlap with grass strips</span>
<span class="sd">    in vct_grass_strips if the overlap for both features is at least 75%.</span>

<span class="sd">    The function updates the vct_parcels input layer</span>

<span class="sd">    The amount of intersection or overlap between a parcel is caluclated as</span>
<span class="sd">    area_intersect(grass strips, parcel)/area(parcel).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parcels: geopandas.GeoDataFrame</span>
<span class="sd">        Can have any column, should have geometries</span>
<span class="sd">    vct_grass_strips: str or pathlib.Path</span>
<span class="sd">        File path of parcel shapefile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">vct_grass_strips</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">parcels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fname_temp</span> <span class="o">=</span> <span class="n">vct_grass_strips</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;temp_intersect.shp&quot;</span>
    <span class="n">fname_parcels</span> <span class="o">=</span> <span class="n">vct_grass_strips</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;temp_parcels.shp&quot;</span>

    <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
        <span class="c1"># check if NR is in vct_parcels</span>
        <span class="k">if</span> <span class="s2">&quot;NR&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parcels</span><span class="p">:</span>
            <span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parcels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">parcels</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">fname_parcels</span><span class="p">)</span>
        <span class="n">saga_intersection</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">fname_parcels</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">vct_grass_strips</span><span class="p">),</span>
            <span class="n">fname_temp</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># intersect</span>
        <span class="n">parcels_intersection</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fname_temp</span><span class="p">)</span>

        <span class="c1"># couple considered parcels from this year and prior year (only consider</span>
        <span class="c1"># largest intersect)</span>
        <span class="n">parcels_intersection</span><span class="p">[</span><span class="s2">&quot;area_inter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parcels_intersection</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>

        <span class="c1"># find largest interesecting parcel and select only those</span>
        <span class="n">parcels_intersection</span><span class="p">[</span><span class="s2">&quot;area_inter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parcels_intersection</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;NR&quot;</span><span class="p">)[</span>
            <span class="s2">&quot;area_inter&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">parcels_intersection</span><span class="p">[</span><span class="s2">&quot;area_inter_max&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parcels_intersection</span><span class="p">[</span><span class="s2">&quot;area_inter&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">parcels_intersection</span> <span class="o">=</span> <span class="n">parcels_intersection</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>

        <span class="c1"># load parcels</span>
        <span class="n">parcels</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">values</span>

        <span class="n">parcels</span> <span class="o">=</span> <span class="n">parcels</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">parcels_intersection</span><span class="p">[[</span><span class="s2">&quot;NR&quot;</span><span class="p">,</span> <span class="s2">&quot;area_inter&quot;</span><span class="p">]],</span>
            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;NR&quot;</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># normalize area intersction  with area of parcel of considered year</span>
        <span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;norm_over&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;area_inter&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># define condition</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;norm_over&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">|</span> <span class="p">(</span><span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;norm_over&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">75</span><span class="p">)</span>
        <span class="n">parcels</span> <span class="o">=</span> <span class="n">parcels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
        <span class="n">parcels</span> <span class="o">=</span> <span class="n">parcels</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;area_inter_max&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_over&quot;</span><span class="p">,</span> <span class="s2">&quot;area_inter&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">parcels</span></div>



<div class="viewcode-block" id="convert_grass_strips_to_agricultural_fields">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.convert_grass_strips_to_agricultural_fields">[docs]</a>
<span class="k">def</span> <span class="nf">convert_grass_strips_to_agricultural_fields</span><span class="p">(</span><span class="n">parcels</span><span class="p">,</span> <span class="n">vct_grass_strips</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert known grass strips to agricultural fields in the parcels shape file.</span>

<span class="sd">    If a parcel in vct_parcels intersects for 75% or more with a grass strip in</span>
<span class="sd">    vct_grass_strips, the attributes of the parcel are changed: &quot;LANDUSE&quot; is set</span>
<span class="sd">    to -9999 (agriculture), &quot;GWSCOD_H&quot; is set to &quot;9999&quot; (unknown crop) and</span>
<span class="sd">    &quot;C-factor&quot; is set to 0.37. This function updates the input vct_parcels.</span>

<span class="sd">    The amount of intersection or overlap between a parcel is caluclated as</span>
<span class="sd">    area_intersect(grasstri, parcel)/area(parcel).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parcels: geopandas.GeoDataFrame</span>
<span class="sd">        Can have any column, should have geometries</span>

<span class="sd">    vct_grass_strips: str or pathlib.Path</span>
<span class="sd">        File path of parcel shapefiles</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    parcels: geopandas.GeoDataFrame</span>
<span class="sd">        With added column:</span>

<span class="sd">        - *default_cfactor* (bool): convert to default C-factor (and landuse).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">vct_grass_strips</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parcels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;C_factor&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parcels</span><span class="p">:</span>
            <span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;C_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">gdf_grass</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vct_grass_strips</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">parcels</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">nearly_identical</span><span class="p">(</span><span class="n">gdf_grass</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">gdf_grass_matched</span> <span class="o">=</span> <span class="n">gdf_grass</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">matches</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">gdf_grass_matched</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">index</span>
        <span class="n">gdf_grass_matched</span><span class="p">[</span><span class="s2">&quot;grasstrip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gdf_grass_matched</span> <span class="o">=</span> <span class="n">gdf_grass_matched</span><span class="p">[[</span><span class="s2">&quot;grasstrip&quot;</span><span class="p">]]</span>
        <span class="n">parcels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">parcels</span><span class="p">,</span>
            <span class="n">gdf_grass_matched</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">parcels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;grasstrip&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;LANDUSE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
        <span class="n">parcels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;grasstrip&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;GWSCOD_H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9999</span>
        <span class="n">parcels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">parcels</span><span class="p">[</span><span class="s2">&quot;grasstrip&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;C_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.37</span>

    <span class="k">return</span> <span class="n">parcels</span></div>



<div class="viewcode-block" id="assign_buffer_id_to_df_buffer">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.assign_buffer_id_to_df_buffer">[docs]</a>
<span class="k">def</span> <span class="nf">assign_buffer_id_to_df_buffer</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign buffer id and extention id to buffer dataframe.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df: pandas.DataFrame</span>
<span class="sd">        Buffer dataframe with columns</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    df: pandas.DataFrame</span>
<span class="sd">        Updated with:</span>

<span class="sd">        - *buf_id* (int): buffer id.</span>
<span class="sd">        - *buf_exid* (int): buffer extension id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;buf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;buf_exid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;buf_id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="mi">14</span>

    <span class="k">return</span> <span class="n">df</span></div>



<div class="viewcode-block" id="add_tillage_technical_measures_to_parcels">
<a class="viewcode-back" href="../../api/pywatemsedem.html#pywatemsedem.scenario.add_tillage_technical_measures_to_parcels">[docs]</a>
<span class="k">def</span> <span class="nf">add_tillage_technical_measures_to_parcels</span><span class="p">(</span><span class="n">gdf_parcels</span><span class="p">,</span> <span class="n">gdf_tillage_technical</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add crop technical measures to parcels vector data.</span>

<span class="sd">    An overlap between the target parcel polygons and source technical polygons is</span>
<span class="sd">    computed to determine for which parcels a tillage technical measure should be</span>
<span class="sd">    applied.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf_parcels: geopandas.GeoDataFrame</span>
<span class="sd">        Parcels polygon vector</span>
<span class="sd">    gdf_tillage_technical: geopandas.GeoDataFrame</span>
<span class="sd">        Tillage technical polygon vector</span>
<span class="sd">    overlap: int</span>
<span class="sd">        Minimal required overlap between polygons to select the implementation of a</span>
<span class="sd">        tillage technical measure to be applied for the parcel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="n">gdf_parcels</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">nearly_identical</span><span class="p">(</span><span class="n">gdf_tillage_technical</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">matches2</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">df_teelttech_matched</span> <span class="o">=</span> <span class="n">gdf_tillage_technical</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">matches2</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">df_teelttech_matched</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">matches2</span><span class="o">.</span><span class="n">index</span>

    <span class="n">df_teelttech_matched</span> <span class="o">=</span> <span class="n">df_teelttech_matched</span><span class="p">[[</span><span class="s2">&quot;category&quot;</span><span class="p">]]</span>

    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">gdf_parcels</span><span class="p">,</span> <span class="n">df_teelttech_matched</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ntkerend&quot;</span><span class="p">,</span> <span class="s2">&quot;ntkerend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;drempels&quot;</span><span class="p">,</span> <span class="s2">&quot;drempels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;contourzaaien&quot;</span><span class="p">,</span> <span class="s2">&quot;contour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gewasrest&quot;</span><span class="p">,</span> <span class="s2">&quot;gewasrest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;groenbedekker&quot;</span><span class="p">,</span> <span class="s2">&quot;groenbedek&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;ntkerend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_merged</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fluves.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>